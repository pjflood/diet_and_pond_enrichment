---
title: "05_niches_SIBER_stomach_contents"
author: "Peter Flood"
date: "2024-03-04"
output: 
  html_document:
    toc: true
    df_print: paged
    number_sections: true
  html_notebook:
    toc: true
    toc_float: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load Libraries
```{r}
library(tidyverse)
library(SIBER)
library(openxlsx)
library(coda)
library(tRophicPosition)
library(ggpubr)
library(ggforce)
library(viridis)
```

#Post-Invasion
## Load data
This file is output from 03_diets_from_stomach_contents.Rmd
```{r}
post.consumer.nmds <- read.csv("Outputs/Stomach Contents/Diet/Post-Invasion/post_nmds_consumers.csv")
```

## Format data for SIBER package
```{r}
#unite habitat and season columns to form community variable
stomach.habitat.season <- post.consumer.nmds %>% 
  unite(col = "community", Slough, Habitat, Season) %>% 
  rename(group = size_class, iso1 = MDS1, iso2 = MDS2) %>% 
  select(-c(ID))

#dropping size classes where n < 3 for a slough-habitat-season level
siber.data <- stomach.habitat.season %>% 
  select(iso1, iso2, group, community) %>% 
  group_by(group, community) %>% 
  filter(n()>2, sd(iso1)!=0, sd(iso2)!=0, !is.na(iso1), !is.na(iso2)) %>% 
  ungroup() %>% 
  as.data.frame() %>% 
  arrange(community, group)

#create object that has dropped groups (not all rows that were dropped)
removed.consumers <- stomach.habitat.season[!(stomach.habitat.season$group %in% siber.data$group),]
```

Create SIBER object, example sample sizes
```{r}
#createSiberObject
global.siber <- createSiberObject(siber.data)

#write out table of sample sizes
write.csv(global.siber[["sample.sizes"]] %>% t(), "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/siber_global_n_table_stomachs.csv")
```
Visualize SIBER object
```{r}
# Create lists of plotting arguments to be passed onwards to each 
# of the three plotting functions.
community.hulls.args <- list(col = 1, lty = 1, lwd = 1)
group.ellipses.args  <- list(n = 100, p.interval = 0.95, lty = 1, lwd = 2)
group.hull.args      <- list(lty = 2, col = "grey20")

par(mfrow=c(1,1))
plotSiberObject(global.siber,
                ax.pad = 2, 
                hulls = F, community.hulls.args, 
                ellipses = T, group.ellipses.args,
                group.hulls = T, group.hull.args,
                bty = "L",
                iso.order = c(1,2),
                xlab = expression(d13C),
                ylab = expression(d15N)
)
```
## Calculate TA, SEA, and SEAc
```{r}
global.ML <- groupMetricsML(global.siber)
print(global.ML)
write.csv(t(global.ML), file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/all_spp_ML_stomachs.csv")
```

## Calculate Layman metrics
```{r}
#calculate Layman metrics
post.layman.metrics <- communityMetricsML(global.siber)
```

## SIBER model
Set up model parameters
```{r}
#set up the model parameters 
# options for running jags
parms <- list()
parms$n.iter <- 2 * 10^6   # number of iterations to run the model for
parms$n.burnin <- 1 * 10^4 # discard the first set of values
parms$n.thin <- 100     # thin the posterior by this many
parms$n.chains <- 2        # run this many chains
parms$save.output = T
parms$save.dir = getwd()

# define the priors
priors <- list()
priors$R <- 1 * diag(2)
priors$k <- 2
priors$tau.mu <- 1.0E-3
```

Run SIBER model
```{r}
# fit the ellipses which uses an Inverse Wishart prior
# on the covariance matrix Sigma, and a vague normal prior on the 
# means. Fitting is via the JAGS method.
global.ellipses.posterior <- siberMVN(global.siber, parms, priors)

#calculate posterior estimates of ellipses for all groups
SEA.B<-siberEllipses(global.ellipses.posterior)
colnames(SEA.B)<-names(global.ellipses.posterior)
```

### Extract SIBER output
```{r}
#calculate credibility intervals
cr.p<-c(0.5, 0.95, 0.99) #vector of desired quantiles

#call hdrcde_hdr using lapply()
SEA.B.credibles<-lapply(
  as.data.frame(SEA.B), 
  function(x,...){tmp<-hdrcde::hdr(x)$hdr},
  prob = cr.p)

#match up group names
names(SEA.B.credibles)<-colnames(global.ML)

#this carries through the row names from matrices in SEA.B.credibles
#they don't turn out all that clean though, so adding a column later with the same info
y <- do.call(function(...) {
  tmp <- plyr::rbind.fill.matrix(...)
  rownames(tmp) <- sapply(SEA.B.credibles, function(i) {
    rownames(i)
  })
  return(tmp)
}, SEA.B.credibles)

y

#object with cleaned-up row names
interval<-rep(c("99%", "95%", "50%"), 134)

#replicated each name three times in sequence to match up with new data frame
seab.names<-data.frame(rep(names(SEA.B.credibles), each = 3))
colnames(seab.names)<-"names"

#seab.names<-separate(seab.names, col = names, into = c('hab.season', 'spp'), extra = "merge")

#combine names with new data frame
seab.cred.matrix<-data.frame(seab.names, interval, y)
colnames(seab.cred.matrix)<-c(colnames(seab.names), "interval", "lower", "upper")

#write out to a csv
write.csv(seab.cred.matrix, file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/global.sc.SEA.B.credibles.csv")

# do similar to get the modes, taking care to pick up multimodal posterior
# distributions if present
SEA.B.modes<-lapply(
  as.data.frame(SEA.B), 
  function(x,...){tmp<-hdrcde::hdr(x)$mode},
  prob = cr.p, all.modes=T)

#need to do the same as for the credible intervals to get the colnames to be
#the names not the numbers
write.csv(SEA.B.modes, file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/global.sc.SEA.B.modes.csv")

#read back in
SEA.B.modes.matrix<-read.csv(file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/global.sc.SEA.B.modes.csv", header = T, row.names = 1)

#change colnames
colnames(SEA.B.modes.matrix)<-colnames(global.ML)
#transpose this matrix
SEA.B.modes.matrix.t<-t(SEA.B.modes.matrix)
#change the name of what is now a single column to mode
colnames(SEA.B.modes.matrix.t)<-"mode"
#write out the final csv over the previous mode csv
write.csv(SEA.B.modes.matrix.t, file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/global.sc.SEA.B.modes.csv")
```

### Slough, Habitat, Season Pairwise Comparisons

Use pairwise comparisons function from tRophicPosition package
```{r}
#turn output into a list
SEA.B.list <- as.list(as.data.frame(SEA.B))

#do all pairwise comparisons with function from tRophicPosition package
SEA.B.pairwise <- pairwiseComparisons(SEA.B.list, print = F)
colnames(SEA.B.pairwise) <- rownames(SEA.B.pairwise)
```
### Niche Visualizations

Format data for plotting
```{r}
post.plot.data <- SEA.B %>% as.data.frame() %>% 
  pivot_longer(everything(), names_to = "Slough_Habitat_Season_Species", values_to = "SEA_B") %>% 
  separate("Slough_Habitat_Season_Species", into = c("Slough_Habitat_Season", "Species"), 
           sep = "[//.]", extra = "merge") %>% 
  separate(Slough_Habitat_Season, into = c("Slough", "Habitat", "Season"), sep = "_") %>% 
  filter(Habitat %in% c("Marsh", "NP", "Pond"))
```

#### Habitat, Season, Slough, Plots
```{r}
windowsFonts(Times = windowsFont("Times New Roman"))

(post.seab<-ggplot(post.plot.data, aes(x = Species, y = SEA_B, fill = Habitat))+
    geom_boxplot(outlier.size = 0,outlier.alpha = 0, lwd = 0.1, alpha = 0.5)+
    facet_wrap(~Slough*Season, scales = "free", ncol = 1)+
    scale_fill_viridis_d(aesthetics = "fill", option = "D", end = 0.75)+
    coord_cartesian(ylim = c(0, 2.5))+
    theme_bw(base_size = 12)+
    xlab(NULL)+
    ylab(expression("Stomach Content Niche Area - SEA"["b"]))+
    theme(text = element_text(family = "Times", size = 12),
          axis.text.x = element_text(angle = 45, vjust = 1.1, hjust = 1, size = 4),
          #panel.border = element_blank(), 
          #panel.grid.major = element_blank(),
          #panel.grid.minor = element_blank(), 
          axis.line = element_line(colour = "black"),
          axis.ticks.x = element_line(size = 0.05),
          axis.title = element_text(size = 12), axis.text.x.bottom = element_text(size = 7),
          axis.text.y = element_text(size = 7), axis.ticks.y = element_line(size = 0.2),
          legend.title = element_blank(), legend.text = element_text(size = 8),
          legend.key.size = unit(0.75, "line"))
  
)

ggsave(filename = "Figures/Stomach Contents/Trophic Niche/Post-Invasion/post_SEAb.tiff", 
       plot = post.seab, dpi = 600, width = 150, height = 225, units = "mm")

post.plot.data.seasonal.comparisons <- post.plot.data %>% 
  filter(#filter for SRS marsh species size classes with seasonal comparisons
          Species %in% c("C.uro1", "E.suc1", "F.chr1", "G.hol1", "G.hol2", "H.for2", "H.let1", "L.goo1", "L.goo2", "L.pun2") &
           Slough == "SRS" & Habitat == "Marsh" |
            #now for SRS near-pond species
            Species %in% c("G.hol1", "G.hol2", "H.for1", "H.for2") & Slough == "SRS" & Habitat == "NP" |
              #now for SRS pond species
            Species %in% c("F.chr1", "G.hol1", "G.hol2", "H.for1", "H.for2", "L.goo1", "L.goo2", "L.gul2", "L.gul3", "L.gul4",
                           "L.pla1", "L.pun2", "P.lat2") & Slough == "SRS" & Habitat == "Pond" |
            #now do the same for TSL
            Species %in% c("F.chr1", "H.for1", "H.for2", "L.goo1", "L.goo2") &
            Slough == "TSL" & Habitat == "Marsh" |
            #no NP dry season TSL data - skip NP 
            Species %in% c("G.hol1", "G.hol2", "H.for2", "L.goo1", "L.goo2", "N.pet1") & Slough == "TSL" & Habitat == "Pond"
           )

(post.seab.season.plot<-ggplot(post.plot.data.seasonal.comparisons %>% 
                                 mutate(Season = fct_rev(Season)),
                               aes(x = Species, y = SEA_B, fill = Season))+
    geom_boxplot(outlier.size = 0,outlier.alpha = 0, lwd = 0.1, alpha = 0.8)+
    facet_grid(Slough ~ Habitat, scales = "free")+
    scale_fill_viridis_d(aesthetics = "fill", begin = 0.2, end = 0.88)+
    coord_cartesian(ylim = c(0, 1.25))+
    theme_bw(base_size = 12)+
    xlab(NULL)+
    ylab(expression("Stomach Content Niche Area - SEA"["b"]))+
    theme(text = element_text(family = "Times", size = 12),
          axis.text.x = element_text(angle = 45, vjust = 1.1, hjust = 1, size = 4),
          #panel.border = element_blank(), 
          #panel.grid.major = element_blank(),
          #panel.grid.minor = element_blank(), 
          axis.line = element_line(colour = "black"),
          axis.ticks.x = element_line(size = 0.05),
          axis.title = element_text(size = 12), axis.text.x.bottom = element_text(size = 7),
          axis.text.y = element_text(size = 7), axis.ticks.y = element_line(size = 0.2),
          legend.title = element_blank(), legend.text = element_text(size = 8),
          legend.key.size = unit(0.75, "line"))
  
)

ggsave(filename = "Figures/Stomach Contents/Trophic Niche/Post-Invasion/post_SEAb_seasonal_comparisons.tiff", 
       plot = post.seab.season.plot,
       dpi = 600, height = 150, width = 225, units = "mm")
```

#### Niche Ellipses
```{r}
(sc.niche.ellipse.plot <- ggplot(post.consumer.nmds %>% 
                                   filter(size_class %in% c("G.hol2", "L.goo2"),
                                          Habitat != "Sawgrass",
                                          !(Habitat == "NP" & Slough == "TSL")) %>% 
                                   mutate(Species = case_when(
                                     size_class == "G.hol2" ~ "Eastern Mosquitofish (adults)",
                                     size_class == "L.goo2" ~ "Bluefin Killifish (adults)"
                                   )), 
                                 aes(x = MDS1, y = MDS2, color = Season, fill = Season))+
    #geom_point()+
    stat_conf_ellipse(geom = "polygon", alpha = 0.8)+
    facet_grid(Species ~ Habitat*Slough)+
    labs(y = "MDS2", x = "MDS1")+
    scale_fill_viridis_d(end = 0.8)+
    scale_color_viridis_d(end = 0.8)+
    coord_fixed()+
    theme_bw()+
    theme(axis.text.x = element_text(size = 6, angle = 45, hjust = 1),
          panel.spacing.x = unit(0.75, "lines"))
)

ggsave(filename = "Figures/Stomach Contents/Trophic Niche/Post-Invasion/sc_niche_ellipse_plot.tiff", 
       plot = sc.niche.ellipse.plot,
       height = 150, width = 200, units = "mm", dpi = 300)
```

### Seasonal Pairwise Comparisons

Reformat to have seasonal comparisons within each slough-habitat level

#### SRS Marsh Wet-Dry Comparisons
```{r}
srs.marsh.wet.dry.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Marsh", Season == "Wet") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Marsh", Season == "Dry") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
srs.marsh.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Marsh") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Season, values_from = mode) %>% 
  filter(!is.na(Wet), !is.na(Dry))

srs.marsh.wet.dry.direct.pairwise <- srs.marsh.wet.dry.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(srs.marsh.wet.dry.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., srs.marsh.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("Wet"), contains("Dry"), everything()) %>% select(-c(Season)) %>% 
  rename(`Dry < Wet` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Dry < Wet` >= 0.95 ~ "Decrease",
      `Dry < Wet` < 0.05 ~ "Increase",
      `Dry < Wet` > 0.05 | `Dry < Wet` < 0.95 ~ "No Change"),
    `Percent Change` = ((Wet-Dry)/Dry)*100,
    `Size Class` = case_when(
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Slough, Habitat, `Size Class`, Wet, Dry, `Dry < Wet`, `Percent Change`)

#write this out to excel
write.csv(srs.marsh.wet.dry.direct.pairwise, 
          file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/srs_marsh_wet_dry_SEAB_prob_diff.csv", 
          row.names = F)
```

#### SRS Near Pond Wet-Dry Comparisons
```{r}
srs.np.wet.dry.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "NP", Season == "Wet") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "NP", Season == "Dry") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
srs.np.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "NP") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Season, values_from = mode) %>% 
  filter(!is.na(Wet), !is.na(Dry))

srs.np.wet.dry.direct.pairwise <- srs.np.wet.dry.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(srs.np.wet.dry.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., srs.np.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("Wet"), contains("Dry"), everything()) %>% select(-c(Season)) %>% 
  rename(`Dry < Wet` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Dry < Wet` >= 0.95 ~ "Decrease",
      `Dry < Wet` < 0.05 ~ "Increase",
      `Dry < Wet` > 0.05 | `Dry < Wet` < 0.95 ~ "No Change"),
    `Percent Change` = ((Wet-Dry)/Dry)*100,
    `Size Class` = case_when(
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PROFAL" ~ "P. fallax",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Slough, Habitat, `Size Class`, Wet, Dry, `Dry < Wet`, `Percent Change`)

#write this out to excel
write.csv(srs.np.wet.dry.direct.pairwise, 
          file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/srs_np_wet_dry_SEAB_prob_diff.csv",
          row.names = F)
```

#### SRS Pond Wet-Dry Comparisons
```{r}
srs.pond.wet.dry.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Pond", Season == "Wet") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Pond", Season == "Dry") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
srs.pond.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Pond") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Season, values_from = mode) %>% 
  filter(!is.na(Wet), !is.na(Dry))

srs.pond.wet.dry.direct.pairwise <- srs.pond.wet.dry.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(srs.pond.wet.dry.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., srs.pond.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("Wet"), contains("Dry"), everything()) %>% select(-c(Season)) %>% 
  rename(`Dry < Wet` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Dry < Wet` >= 0.95 ~ "Decrease",
      `Dry < Wet` < 0.05 ~ "Increase",
      `Dry < Wet` > 0.05 | `Dry < Wet` < 0.95 ~ "No Change"),
    `Percent Change` = ((Wet-Dry)/Dry)*100,
    `Size Class` = case_when(
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Slough, Habitat, `Size Class`, Wet, Dry, `Dry < Wet`, `Percent Change`)

#write this out to excel
write.csv(srs.pond.wet.dry.direct.pairwise, 
          file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/srs_pond_wet_dry_SEAB_prob_diff.csv",
          row.names = F)
```

#### TSL Marsh Wet-Dry Comparisons
```{r}
tsl.marsh.wet.dry.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Marsh", Season == "Wet") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Marsh", Season == "Dry") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
tsl.marsh.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Marsh") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Season, values_from = mode) %>% 
  filter(!is.na(Wet), !is.na(Dry))

tsl.marsh.wet.dry.direct.pairwise <- tsl.marsh.wet.dry.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(tsl.marsh.wet.dry.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., tsl.marsh.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("Wet"), contains("Dry"), everything()) %>% select(-c(Season)) %>% 
  rename(`Dry < Wet` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Dry < Wet` >= 0.95 ~ "Decrease",
      `Dry < Wet` < 0.05 ~ "Increase",
      `Dry < Wet` > 0.05 | `Dry < Wet` < 0.95 ~ "No Change"),
    `Percent Change` = ((Wet-Dry)/Dry)*100,
    `Size Class` = case_when(
      `Size Class` == "BLUE MITE" ~ "Hydrachnidia",
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "CHIRON" ~  "Chironomidae",
      `Size Class` == "COENAG" ~ "Coenagrionidae",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      `Size Class` == "CORIXI" ~ "Corixidae",
      `Size Class` == "EPHEME" ~ "Ephemeroptera",
      `Size Class` == "ERYSIM" ~ "E. simplicicollis",
      `Size Class` == "GERRID" ~ "Gerridae",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Slough, Habitat, `Size Class`, Wet, Dry, `Dry < Wet`, `Percent Change`)

#write this out to excel
write.csv(tsl.marsh.wet.dry.direct.pairwise, 
          file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/tsl_marsh_wet_dry_SEAB_prob_diff.csv",
          row.names = F)
```

#### TSL Near Pond Wet-Dry Comparisons

All TSL near-pond habitats were dry when sampled during the dry season so wet-dry comparisons could not be made

#### TSL Pond Wet-Dry Comparisons
```{r}
tsl.pond.wet.dry.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Pond", Season == "Wet") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Pond", Season == "Dry") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
tsl.pond.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Pond") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Season, values_from = mode) %>% 
  filter(!is.na(Wet), !is.na(Dry))

tsl.pond.wet.dry.direct.pairwise <- tsl.pond.wet.dry.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(tsl.pond.wet.dry.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., tsl.pond.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("Wet"), contains("Dry"), everything()) %>% select(-c(Season)) %>% 
  rename(`Dry < Wet` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Dry < Wet` >= 0.95 ~ "Decrease",
      `Dry < Wet` < 0.05 ~ "Increase",
      `Dry < Wet` > 0.05 | `Dry < Wet` < 0.95 ~ "No Change"),
    `Percent Change` = ((Wet-Dry)/Dry)*100,
    `Size Class` = case_when(
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Slough, Habitat, `Size Class`, Wet, Dry, `Dry < Wet`, `Percent Change`)

#write this out to excel
write.csv(tsl.pond.wet.dry.direct.pairwise, 
          file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/tsl_pond_wet_dry_SEAB_prob_diff.csv",
          row.names = F)
```

#### Combine Output for Seasonal Comparisons
```{r}
seasonal.pairiwse <- bind_rows(srs.marsh.wet.dry.direct.pairwise, srs.np.wet.dry.direct.pairwise, srs.pond.wet.dry.direct.pairwise,
                               tsl.marsh.wet.dry.direct.pairwise, tsl.pond.wet.dry.direct.pairwise)
write.csv(seasonal.pairiwse, 
          "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/season_pairiwise.csv",
          row.names = F)

#proportion of statistical changes in wet-dry comparisons
sum(seasonal.pairiwse$`Dry < Wet`>=0.95 | seasonal.pairiwse$`Dry < Wet`<=0.05)/nrow(seasonal.pairiwse) 

#mean and sd % change all seasonal changes
seasonal.pairiwse %>% 
  filter(`Dry < Wet` >= 0.95 | `Dry < Wet` <= 0.05) %>% 
  mutate(`Percent Change` = abs(`Percent Change`)) %>% 
  summarize_at(.vars = "Percent Change", list(mean = mean, sd = sd))

#break it down by habitat
#marsh
#frequency
sum(srs.marsh.wet.dry.direct.pairwise$`Dry < Wet`>=0.95|
      srs.marsh.wet.dry.direct.pairwise$`Dry < Wet`<=0.05,
    tsl.marsh.wet.dry.direct.pairwise$`Dry < Wet`>=0.95|
      tsl.marsh.wet.dry.direct.pairwise$`Dry < Wet`<=0.05)/
  nrow(bind_rows(srs.marsh.wet.dry.direct.pairwise, tsl.marsh.wet.dry.direct.pairwise))
#magnitude
bind_rows(srs.marsh.wet.dry.direct.pairwise, tsl.marsh.wet.dry.direct.pairwise)%>% 
  filter(`Dry < Wet` >= 0.95 | `Dry < Wet` <= 0.05) %>% 
  mutate(`Percent Change` = abs(`Percent Change`)) %>% 
  summarize_at(.vars = "Percent Change", list(mean = mean, sd = sd))

#NP - no TSL NP
#frequency
sum(srs.np.wet.dry.direct.pairwise$`Dry < Wet`>=0.95|
      srs.np.wet.dry.direct.pairwise$`Dry < Wet`<=0.05)/
  nrow(srs.np.wet.dry.direct.pairwise)
#magnitude
bind_rows(srs.np.wet.dry.direct.pairwise)%>% 
  filter(`Dry < Wet` >= 0.95 | `Dry < Wet` <= 0.05) %>% 
  mutate(`Percent Change` = abs(`Percent Change`)) %>% 
  summarize_at(.vars = "Percent Change", list(mean = mean, sd = sd))

#Pond
#frequency
sum(srs.pond.wet.dry.direct.pairwise$`Dry < Wet`>=0.95|
      srs.pond.wet.dry.direct.pairwise$`Dry < Wet`<=0.05,
    tsl.pond.wet.dry.direct.pairwise$`Dry < Wet`>=0.95|
      tsl.pond.wet.dry.direct.pairwise$`Dry < Wet`<=0.05)/
  nrow(bind_rows(srs.pond.wet.dry.direct.pairwise, tsl.pond.wet.dry.direct.pairwise))
#magnitude
bind_rows(srs.pond.wet.dry.direct.pairwise, tsl.pond.wet.dry.direct.pairwise)%>% 
  filter(`Dry < Wet` >= 0.95 | `Dry < Wet` <= 0.05) %>% 
  mutate(`Percent Change` = abs(`Percent Change`)) %>% 
  summarize_at(.vars = "Percent Change", list(mean = mean, sd = sd))
```
#### Seasonal Percent Change Plots
Format data for plotting
```{r}
all.season.direct.pairwise <- bind_rows(
  srs.marsh.wet.dry.direct.pairwise, srs.np.wet.dry.direct.pairwise, srs.pond.wet.dry.direct.pairwise,
  tsl.marsh.wet.dry.direct.pairwise, tsl.pond.wet.dry.direct.pairwise #no tsl.np.wet.dry.direct.pairwise
  ) %>% 
  mutate(`Size Class` = case_when(
    `Size Class` == "C.uro1" ~ "M.uro1",
    T ~ `Size Class`
  )) %>% 
  rename(`Wet < Dry` = `Dry < Wet`) %>% 
  mutate(Trophic_Guild = case_when(
    `Size Class` %in% c("P.lat2" ) ~ "Detritivore",
    `Size Class` %in% c("M.uro1", "H.let1", "G.hol1", "G.hol2", "E.suc1") ~ "Omnivore",
    `Size Class` %in% c("N.pet1", "L.goo1", "L.goo2", "H.for1", "H.for2", "F.chr1") ~ "Invertivore",
    `Size Class` %in% c("L.pun2", "L.pla1", "L.gul4", "L.gul3", "L.gul2") ~ "Mesopredator"
    ),
    Trophic_Score = case_when(
      Trophic_Guild == "Mesopredator" ~ 4,
      Trophic_Guild == "Invertivore" ~ 3,
      Trophic_Guild == "Omnivore" ~ 2,
      Trophic_Guild == "Detritivore" ~ 1
    ),
    `Size Class` = fct_reorder(`Size Class`, Trophic_Score)) %>% 
  rename(`Trophic Guild` = Trophic_Guild)
```

Percent change for seasonal changes
```{r}
windowsFonts(Times = windowsFont("Times New Roman"))

(season.percent.change.plot <- ggplot(data = all.season.direct.pairwise, 
                                      aes(y = `Size Class`, x = `Percent Change`, fill = Habitat, 
                                          color = Habitat, shape = Slough))+
    geom_point(aes(size = `Wet < Dry`))+
    scale_shape_manual(values = c(22,24))+
    scale_fill_viridis_d(end = 0.8)+
    scale_color_viridis_d(end = 0.8)+
    scale_size_continuous(breaks = c(0.05, 0.25, 0.75, 0.95))+
    facet_zoom(xlim = c(-100, 100))+
    geom_hline(yintercept = 12.5, linetype = "dashed", color = viridis(n=4, option = "A")[1])+
    geom_hline(yintercept = 6.5, linetype = "dashed", color = viridis(n=4, option = "A")[2])+
    geom_hline(yintercept = 1.5, linetype = "dashed", color = viridis(n=4, option = "A")[3])+
    theme_bw()+
    theme(text = element_text(family = "Times"))
  
)

ggsave("Figures/Stomach Contents/Trophic Niche/Post-Invasion/stomach_contents_season_percent_change_plot.tiff", 
       plot = season.percent.change.plot, dpi = 300,
       height = 250, width = 150, units = "mm")
```

Boxplots for percent change per habitat across all species
```{r}
(season.percent.change.boxplot <- ggplot(data = all.season.direct.pairwise %>% 
                                           mutate(Habitat = gsub("NP", "Near Pond", Habitat)), 
                                           aes(y = `Percent Change`, x = Habitat))+
    geom_boxplot()+
    facet_zoom(ylim = c(-100, 100))+
    scale_x_discrete(limits = c("Pond", "Near Pond", "Marsh"))+
    theme_bw()+
    theme(text = element_text(family = "Times"))
  
)
```
```{r}
all.season.direct.pairwise.long <- all.season.direct.pairwise %>% 
  pivot_longer(cols = c(Wet, Dry), names_to = "Season", values_to = "Niche Area") %>% 
  mutate(Habitat = gsub("NP", "Near Pond", Habitat))


(season.niche.area.habitat.plot <- ggplot(data = all.season.direct.pairwise.long,
                                          aes(x = Season, y = `Niche Area`))+
    geom_boxplot()+
    facet_zoom(ylim = c(0, 1))+
    facet_wrap(~Habitat)+
    scale_x_discrete(limits = c("Wet", "Dry"))
    #coord_cartesian(ylim = c(0,1))
  
)

season.niche.shifts <- all.season.direct.pairwise.long %>% 
  filter(`Wet < Dry` <= 0.05 | `Wet < Dry` >= 0.95)

season.niche.shifts %>% group_by(Habitat, Season) %>% tally()

(sc.season.niche.area.shifts.habitat.plot <- ggplot(data = season.niche.shifts,
                                          aes(x = Season, y = `Niche Area`))+
    geom_boxplot()+
    #facet_zoom(ylim = c(0, 1))+
    facet_wrap(~Habitat)+
    scale_x_discrete(limits = c("Wet", "Dry"))+
    coord_cartesian(ylim = c(0,1))+
    ylab(label = expression(Niche[SCA]))+
    theme_bw()+
    theme(text = element_text(family = "Times", size = 8),
          axis.text.y = element_text(size = 6))
  
)

ggsave("Figures/Stomach Contents/Trophic Niche/Post-Invasion/stomach_contents_seasonal_niche_shifts_per_habitat.tiff", 
       plot = sc.season.niche.area.shifts.habitat.plot, 
       dpi = 300, height = 150, width = 250, units = "mm")

season.niche.shifts %>% group_by(Habitat, Season, `Trophic Guild`) %>% tally() %>% 
  arrange(Habitat, `Trophic Guild`)

(sc.season.niche.area.shifts.guild.habitat.plot <- ggplot(data = season.niche.shifts,
                                                 aes(x = Season, y = `Niche Area`))+
    geom_boxplot()+
    #facet_zoom(ylim = c(0, 1))+
    facet_wrap(~Habitat*`Trophic Guild`, scales = "free_y")+
    scale_x_discrete(limits = c("Wet", "Dry"))+
    #coord_cartesian(ylim = c(0,1))+
    ylab(label = expression(Niche[SCA]))+
    theme_bw()+
    theme(text = element_text(family = "Times", size = 8),
          axis.text.y = element_text(size = 6))
  
)

ggsave("Figures/Stomach Contents/Trophic Niche/Post-Invasion/stomach_contents_seasonal_niche_shifts_guild_per_habitat.tiff", 
       plot = sc.season.niche.area.shifts.guild.habitat.plot, 
       dpi = 300, height = 150, width = 250, units = "mm")
```

### Slough Pairwise Comparisons
#### SRS-TSL Marsh Wet Season Comparisons
```{r}
slough.marsh.wet.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Marsh", Season == "Wet") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Marsh", Season == "Wet") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
slough.marsh.wet.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Season == "Wet", Habitat == "Marsh") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Slough, values_from = mode) %>% 
  filter(!is.na(SRS), !is.na(TSL))

slough.marsh.wet.direct.pairwise <- slough.marsh.wet.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(slough.marsh.wet.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., slough.marsh.wet.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("TSL"), contains("SRS"), everything()) %>% select(-c(Slough)) %>% 
  rename(`TSL < SRS` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `TSL < SRS` >= 0.95 ~ "Decrease",
      `TSL < SRS` < 0.05 ~ "Increase",
      `TSL < SRS` > 0.05 | `TSL < SRS` < 0.95 ~ "No Change"),
    `Percent Change` = ((TSL-SRS)/SRS)*100,
    `Size Class` = case_when(
      `Size Class` == "BELSPP" ~ "Belostoma spp.",
      `Size Class` == "CHIRON" ~ "Chironomidae",
      `Size Class` == "COENAG" ~ "Coenagrionidae",
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Season, Habitat, `Size Class`, TSL, SRS, `TSL < SRS`, `Percent Change`)

#write this out to excel
write.csv(slough.marsh.wet.direct.pairwise, 
          file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/slough_marsh_wet_SEAB_prob_diff.csv",
          row.names = F)
```

#### SRS-TSL Near Pond Wet Comparisons
```{r}
slough.np.wet.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "NP", Season == "Wet") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "NP", Season == "Wet") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
slough.np.wet.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Season == "Wet", Habitat == "NP") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Slough, values_from = mode) %>% 
  filter(!is.na(SRS), !is.na(TSL))

slough.np.wet.direct.pairwise <- slough.np.wet.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(slough.np.wet.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., slough.np.wet.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("TSL"), contains("SRS"), everything()) %>% select(-c(Slough)) %>% 
  rename(`TSL < SRS` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `TSL < SRS` >= 0.95 ~ "Decrease",
      `TSL < SRS` < 0.05 ~ "Increase",
      `TSL < SRS` > 0.05 | `TSL < SRS` < 0.95 ~ "No Change"),
    `Percent Change` = ((TSL-SRS)/SRS)*100,
    `Size Class` = case_when(
      `Size Class` == "BELSPP" ~ "Belostoma spp.",
      `Size Class` == "CHIRON" ~ "Chironomidae",
      `Size Class` == "COENAG" ~ "Coenagrionidae",
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Season, Habitat, `Size Class`, TSL, SRS, `TSL < SRS`, `Percent Change`)

#write this out to excel
write.csv(slough.np.wet.direct.pairwise, 
          file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/slough_np_wet_SEAB_prob_diff.xlsx",
          row.names = F)
```

#### SRS-TSL Pond Wet Comparisons
```{r}
slough.pond.wet.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Pond", Season == "Wet") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Pond", Season == "Wet") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
slough.pond.wet.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Season == "Wet", Habitat == "Pond") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Slough, values_from = mode) %>% 
  filter(!is.na(SRS), !is.na(TSL))

slough.pond.wet.direct.pairwise <- slough.pond.wet.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(slough.pond.wet.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., slough.pond.wet.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("TSL"), contains("SRS"), everything()) %>% select(-c(Slough)) %>% 
  rename(`TSL < SRS` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `TSL < SRS` >= 0.95 ~ "Decrease",
      `TSL < SRS` < 0.05 ~ "Increase",
      `TSL < SRS` > 0.05 | `TSL < SRS` < 0.95 ~ "No Change"),
    `Percent Change` = ((TSL-SRS)/SRS)*100,
    `Size Class` = case_when(
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Season, Habitat, `Size Class`, TSL, SRS, `TSL < SRS`, `Percent Change`)

#write this out to excel
write.csv(slough.pond.wet.direct.pairwise, 
          file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/slough_pond_wet_SEAB_prob_diff.csv",
          row.names = F)
```

#### SRS-TSL Marsh Dry Season Comparisons
```{r}
slough.marsh.dry.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Marsh", Season == "Dry") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Marsh", Season == "Dry") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
slough.marsh.dry.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Season == "Dry", Habitat == "Marsh") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Slough, values_from = mode) %>% 
  filter(!is.na(SRS), !is.na(TSL))

slough.marsh.dry.direct.pairwise <- slough.marsh.dry.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(slough.marsh.dry.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., slough.marsh.dry.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("TSL"), contains("SRS"), everything()) %>% select(-c(Slough)) %>% 
  rename(`TSL < SRS` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `TSL < SRS` >= 0.95 ~ "Decrease",
      `TSL < SRS` < 0.05 ~ "Increase",
      `TSL < SRS` > 0.05 | `TSL < SRS` < 0.95 ~ "No Change"),
    `Percent Change` = ((TSL-SRS)/SRS)*100,
    `Size Class` = case_when(
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "BELSPP" ~ "Belostoma spp.",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      `Size Class` == "CHIRON" ~ "Chironomidae",
      `Size Class` == "COENAG" ~ "Coenagrionidae",
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "ERYSIM" ~ "E. simplicicollis",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Season, Habitat, `Size Class`, TSL, SRS, `TSL < SRS`, `Percent Change`)

#write this out to excel
write.csv(slough.marsh.dry.direct.pairwise, 
          file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/slough_marsh_dry_SEAB_prob_diff.xlsx",
          row.names = F)
```

#### SRS-TSL Near Pond Dry Comparisons
Again, no TSL near-pond dry-season data because these habitats had completely dried by the time of our dry-season sampling

#### SRS-TSL Pond Dry Comparisons
```{r}
slough.pond.dry.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Pond", Season == "Dry") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Pond", Season == "Dry") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
slough.pond.dry.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Season == "Dry", Habitat == "Pond") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Slough, values_from = mode) %>% 
  filter(!is.na(SRS), !is.na(TSL))

slough.pond.dry.direct.pairwise <- slough.pond.dry.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(slough.pond.dry.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., slough.pond.dry.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("TSL"), contains("SRS"), everything()) %>% select(-c(Slough)) %>% 
  rename(`TSL < SRS` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `TSL < SRS` >= 0.95 ~ "Decrease",
      `TSL < SRS` < 0.05 ~ "Increase",
      `TSL < SRS` > 0.05 | `TSL < SRS` < 0.95 ~ "No Change"),
    `Percent Change` = ((TSL-SRS)/SRS)*100,
    `Size Class` = case_when(
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "BELSPP" ~ "Belostoma spp.",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      `Size Class` == "CHIRON" ~ "Chironomidae",
      `Size Class` == "COENAG" ~ "Coenagrionidae",
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "ERYSIM" ~ "E. simplicicollis",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Season, Habitat, `Size Class`, TSL, SRS, `TSL < SRS`, `Percent Change`)

#write this out to excel
write.csv(slough.pond.dry.direct.pairwise, 
          file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/slough_pond_dry_SEAB_prob_diff.csv",
          row.names = F)
```
#### Combine Output for Slough Comparisons
```{r}
slough.pairwise <- bind_rows(slough.marsh.dry.direct.pairwise, slough.pond.dry.direct.pairwise,
                             slough.marsh.wet.direct.pairwise, slough.np.wet.direct.pairwise, slough.pond.wet.direct.pairwise)

write.csv(slough.pairwise, 
          "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/slough_pairwise.csv",
          row.names = F)

#proportion of statistical changes in slough comparisons
sum(slough.pairwise$`TSL < SRS`>=0.95 | slough.pairwise$`TSL < SRS`<=0.05)/nrow(slough.pairwise) 

#mean and sd % change all seasonal changes
slough.pairwise %>% 
  filter(`TSL < SRS` >= 0.95 | `TSL < SRS` <= 0.05) %>% 
  mutate(`Percent Change` = abs(`Percent Change`)) %>% 
  summarize_at(.vars = "Percent Change", list(mean = mean, sd = sd))
```

### Habitat Pairwise Comparisons
#### SRS Marsh-Near Pond Wet Season Comparisons
```{r}
srs.wet.marsh.np.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Marsh", Season == "Wet") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "NP", Season == "Wet") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
srs.wet.marsh.np.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat %in%  c("Marsh", "NP"), Season == "Wet") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Habitat, values_from = mode) %>% 
  filter(!is.na(Marsh), !is.na(NP))

srs.wet.marsh.np.direct.pairwise <- srs.wet.marsh.np.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(srs.wet.marsh.np.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., srs.wet.marsh.np.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("Marsh"), contains("NP"), everything()) %>% select(-c(Habitat)) %>% 
  rename(`Marsh < NP` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Marsh < NP` >= 0.95 ~ "Decrease",
      `Marsh < NP` < 0.05 ~ "Increase",
      `Marsh < NP` > 0.05 | `Marsh < NP` < 0.95 ~ "No Change"),
    `Percent Change` = ((NP-Marsh)/Marsh)*100,
    `Size Class` = case_when(
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "BELSPP" ~ "Belostoma spp.",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      `Size Class` == "CHIRON" ~ "Chironomidae",
      `Size Class` == "COENAG" ~ "Coenagrionidae",
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "ERYSIM" ~ "E. simplicicollis",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      `Size Class` == "PROSPP" ~ "Procambarus spp.",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Slough, Season, `Size Class`, Marsh, NP, `Marsh < NP`, `Percent Change`)

#write this out to excel
#write.csv(srs.wet.marsh.np.direct.pairwise, 
#file = "Outputs/Stomach Contents/Trophic Niche/Post-Invasion/srs_wet_marsh_np_SEAB_prob_diff.csv",
#row.names = F
```

#### SRS Marsh-Pond Wet Comparisons
```{r}
srs.wet.marsh.pond.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Marsh", Season == "Wet") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Pond", Season == "Wet") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
srs.wet.marsh.pond.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat %in%  c("Marsh", "Pond"), Season == "Wet") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Habitat, values_from = mode) %>% 
  filter(!is.na(Marsh), !is.na(Pond))

srs.wet.marsh.pond.direct.pairwise <- srs.wet.marsh.pond.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(srs.wet.marsh.pond.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., srs.wet.marsh.pond.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("Marsh"), contains("Pond"), everything()) %>% select(-c(Habitat)) %>% 
  rename(`Marsh < Pond` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Marsh < Pond` >= 0.95 ~ "Decrease",
      `Marsh < Pond` < 0.05 ~ "Increase",
      `Marsh < Pond` > 0.05 | `Marsh < Pond` < 0.95 ~ "No Change"),
    `Percent Change` = ((Pond-Marsh)/Marsh)*100,
    `Size Class` = case_when(
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "BELSPP" ~ "Belostoma spp.",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      `Size Class` == "CHIRON" ~ "Chironomidae",
      `Size Class` == "COENAG" ~ "Coenagrionidae",
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "ERYSIM" ~ "E. simplicicollis",
      `Size Class` == "LIBINC" ~ "L. incesta",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      `Size Class` == "PROSPP" ~ "Procambarus spp.",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Slough, Season, `Size Class`, Marsh, Pond, `Marsh < Pond`, `Percent Change`)
```

#### SRS Near Pond-Pond Wet Season Comparisons
```{r}
srs.wet.np.pond.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "NP", Season == "Wet") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Pond", Season == "Wet") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
srs.wet.np.pond.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat %in%  c("NP", "Pond"), Season == "Wet") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Habitat, values_from = mode) %>% 
  filter(!is.na(NP), !is.na(Pond))

srs.wet.np.pond.direct.pairwise <- srs.wet.np.pond.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(srs.wet.np.pond.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., srs.wet.np.pond.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("NP"), contains("Pond"), everything()) %>% select(-c(Habitat)) %>% 
  rename(`NP < Pond` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `NP < Pond` >= 0.95 ~ "Decrease",
      `NP < Pond` < 0.05 ~ "Increase",
      `NP < Pond` > 0.05 | `NP < Pond` < 0.95 ~ "No Change"),
    `Percent Change` = ((Pond-NP)/NP)*100,
    `Size Class` = case_when(
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "BELSPP" ~ "Belostoma spp.",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      `Size Class` == "CHIRON" ~ "Chironomidae",
      `Size Class` == "COENAG" ~ "Coenagrionidae",
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "ERYSIM" ~ "E. simplicicollis",
      `Size Class` == "LIBINC" ~ "L. incesta",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      `Size Class` == "PROSPP" ~ "Procambarus spp.",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Slough, Season, `Size Class`, NP, Pond, `NP < Pond`, `Percent Change`)
```


#### SRS Marsh-Near Pond Dry Season Comparisons
```{r}
srs.dry.marsh.np.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Marsh", Season == "Dry") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "NP", Season == "Dry") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
srs.dry.marsh.np.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat %in%  c("Marsh", "NP"), Season == "Dry") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Habitat, values_from = mode) %>% 
  filter(!is.na(Marsh), !is.na(NP))

srs.dry.marsh.np.direct.pairwise <- srs.dry.marsh.np.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(srs.dry.marsh.np.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., srs.dry.marsh.np.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("Marsh"), contains("NP"), everything()) %>% select(-c(Habitat)) %>% 
  rename(`Marsh < NP` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Marsh < NP` >= 0.95 ~ "Decrease",
      `Marsh < NP` < 0.05 ~ "Increase",
      `Marsh < NP` > 0.05 | `Marsh < NP` < 0.95 ~ "No Change"),
    `Percent Change` = ((NP-Marsh)/Marsh)*100,
    `Size Class` = case_when(
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "BELSPP" ~ "Belostoma spp.",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      `Size Class` == "CHIRON" ~ "Chironomidae",
      `Size Class` == "COENAG" ~ "Coenagrionidae",
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "ERYSIM" ~ "E. simplicicollis",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      `Size Class` == "PROSPP" ~ "Procambarus spp.",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Slough, Season, `Size Class`, Marsh, NP, `Marsh < NP`, `Percent Change`)
```

#### SRS Marsh-Pond Dry Season Comparisons
```{r}
srs.dry.marsh.pond.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Marsh", Season == "Dry") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Pond", Season == "Dry") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
srs.dry.marsh.pond.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat %in%  c("Marsh", "Pond"), Season == "Dry") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Habitat, values_from = mode) %>% 
  filter(!is.na(Marsh), !is.na(Pond))

srs.dry.marsh.pond.direct.pairwise <- srs.dry.marsh.pond.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(srs.dry.marsh.pond.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., srs.dry.marsh.pond.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("Marsh"), contains("Pond"), everything()) %>% select(-c(Habitat)) %>% 
  rename(`Marsh < Pond` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Marsh < Pond` >= 0.95 ~ "Decrease",
      `Marsh < Pond` < 0.05 ~ "Increase",
      `Marsh < Pond` > 0.05 | `Marsh < Pond` < 0.95 ~ "No Change"),
    `Percent Change` = ((Pond-Marsh)/Marsh)*100,
    `Size Class` = case_when(
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "BELSPP" ~ "Belostoma spp.",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      `Size Class` == "CHIRON" ~ "Chironomidae",
      `Size Class` == "COENAG" ~ "Coenagrionidae",
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "ERYSIM" ~ "E. simplicicollis",
      `Size Class` == "LIBINC" ~ "L. incesta",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PLASCA" ~ "Planorbella spp.",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      `Size Class` == "PROSPP" ~ "Procambarus spp.",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Slough, Season, `Size Class`, Marsh, Pond, `Marsh < Pond`, `Percent Change`)
```

#### SRS Near Pond-Pond Dry Season Comparisons
```{r}
srs.dry.np.pond.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "NP", Season == "Dry") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat == "Pond", Season == "Dry") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
srs.dry.np.pond.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "SRS", Habitat %in%  c("NP", "Pond"), Season == "Dry") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Habitat, values_from = mode) %>% 
  filter(!is.na(NP), !is.na(Pond))

srs.dry.np.pond.direct.pairwise <- srs.dry.np.pond.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(srs.dry.np.pond.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., srs.dry.np.pond.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("NP"), contains("Pond"), everything()) %>% select(-c(Habitat)) %>% 
  rename(`NP < Pond` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `NP < Pond` >= 0.95 ~ "Decrease",
      `NP < Pond` < 0.05 ~ "Increase",
      `NP < Pond` > 0.05 | `NP < Pond` < 0.95 ~ "No Change"),
    `Percent Change` = ((Pond-NP)/NP)*100,
    `Size Class` = case_when(
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "BELSPP" ~ "Belostoma spp.",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      `Size Class` == "CHIRON" ~ "Chironomidae",
      `Size Class` == "COENAG" ~ "Coenagrionidae",
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "ERYSIM" ~ "E. simplicicollis",
      `Size Class` == "LIBINC" ~ "L. incesta",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      `Size Class` == "PROSPP" ~ "Procambarus spp.",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Slough, Season, `Size Class`, NP, Pond, `NP < Pond`, `Percent Change`)
```

#### TSL Marsh-Near Pond Wet Season Comparisons
```{r}
tsl.wet.marsh.np.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Marsh", Season == "Wet") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "NP", Season == "Wet") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
tsl.wet.marsh.np.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat %in%  c("Marsh", "NP"), Season == "Wet") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Habitat, values_from = mode) %>% 
  filter(!is.na(Marsh), !is.na(NP))

tsl.wet.marsh.np.direct.pairwise <- tsl.wet.marsh.np.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(tsl.wet.marsh.np.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., tsl.wet.marsh.np.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("Marsh"), contains("NP"), everything()) %>% select(-c(Habitat)) %>% 
  rename(`Marsh < NP` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Marsh < NP` >= 0.95 ~ "Decrease",
      `Marsh < NP` < 0.05 ~ "Increase",
      `Marsh < NP` > 0.05 | `Marsh < NP` < 0.95 ~ "No Change"),
    `Percent Change` = ((NP-Marsh)/Marsh)*100,
    `Size Class` = case_when(
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "BELSPP" ~ "Belostoma spp.",
      `Size Class` == "BLUE MITE" ~ "Hydrachnidia",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "COLEOA" ~ "Coleoptera",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      `Size Class` == "CHIRON" ~ "Chironomidae",
      `Size Class` == "COENAG" ~ "Coenagrionidae",
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "ERYSIM" ~ "E. simplicicollis",
      `Size Class` == "GERRID" ~ "Gerridae",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PLASCA" ~ "Planorbella spp.",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      `Size Class` == "PROSPP" ~ "Procambarus spp.",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Slough, Season, `Size Class`, Marsh, NP, `Marsh < NP`, `Percent Change`)
```

#### TSL Marsh-Pond Wet Season Comparisons
```{r}
tsl.wet.marsh.pond.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Marsh", Season == "Wet") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Pond", Season == "Wet") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
tsl.wet.marsh.pond.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat %in%  c("Marsh", "Pond"), Season == "Wet") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Habitat, values_from = mode) %>% 
  filter(!is.na(Marsh), !is.na(Pond))

tsl.wet.marsh.pond.direct.pairwise <- tsl.wet.marsh.pond.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(tsl.wet.marsh.pond.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., tsl.wet.marsh.pond.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("Marsh"), contains("Pond"), everything()) %>% select(-c(Habitat)) %>% 
  rename(`Marsh < Pond` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Marsh < Pond` >= 0.95 ~ "Decrease",
      `Marsh < Pond` < 0.05 ~ "Increase",
      `Marsh < Pond` > 0.05 | `Marsh < Pond` < 0.95 ~ "No Change"),
    `Percent Change` = ((Pond-Marsh)/Marsh)*100,
    `Size Class` = case_when(
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "BELSPP" ~ "Belostoma spp.",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      `Size Class` == "CHIRON" ~ "Chironomidae",
      `Size Class` == "COENAG" ~ "Coenagrionidae",
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "ERYSIM" ~ "E. simplicicollis",
      `Size Class` == "LIBINC" ~ "L. incesta",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      `Size Class` == "PROSPP" ~ "Procambarus spp.",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Slough, Season, `Size Class`, Marsh, Pond, `Marsh < Pond`, `Percent Change`)
```

#### TSL NP-Pond Wet Season Comparisons
```{r}
tsl.wet.np.pond.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "NP", Season == "Wet") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Pond", Season == "Wet") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
tsl.wet.np.pond.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat %in%  c("NP", "Pond"), Season == "Wet") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Habitat, values_from = mode) %>% 
  filter(!is.na(NP), !is.na(Pond))

tsl.wet.np.pond.direct.pairwise <- tsl.wet.np.pond.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(tsl.wet.np.pond.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., tsl.wet.np.pond.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("NP"), contains("Pond"), everything()) %>% select(-c(Habitat)) %>% 
  rename(`NP < Pond` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `NP < Pond` >= 0.95 ~ "Decrease",
      `NP < Pond` < 0.05 ~ "Increase",
      `NP < Pond` > 0.05 | `NP < Pond` < 0.95 ~ "No Change"),
    `Percent Change` = ((Pond-NP)/NP)*100,
    `Size Class` = case_when(
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "BELSPP" ~ "Belostoma spp.",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      `Size Class` == "CHIRON" ~ "Chironomidae",
      `Size Class` == "COENAG" ~ "Coenagrionidae",
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "ERYSIM" ~ "E. simplicicollis",
      `Size Class` == "LIBINC" ~ "L. incesta",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      `Size Class` == "PROSPP" ~ "Procambarus spp.",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Slough, Season, `Size Class`, NP, Pond, `NP < Pond`, `Percent Change`)
```

#### TSL Marsh-Near Pond Dry Season Comparisons
No dry-season TSL near-pond data

#### TSL Marsh-Pond Dry Season Comparisons
```{r}
tsl.dry.marsh.pond.pairwise <- SEA.B.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Marsh", Season == "Dry") %>% 
  #unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>% 
  select(-c(Slough, Habitat, Season)) %>% 
  column_to_rownames(var = "SizeClass") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "SizeClass"), sep = 3) %>% 
  mutate(SizeClass = gsub("^.", "", SizeClass)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat == "Pond", Season == "Dry") %>% 
  filter(SizeClass %in% colnames(.)) %>% 
  select(Slough, Habitat, Season, SizeClass, matches(.$SizeClass)) %>% 
  unite(Slough_Habitat_Season_SizeClass, c("Slough", "Habitat", "Season", "SizeClass"), sep = "_") %>% 
  column_to_rownames(var = "Slough_Habitat_Season_SizeClass")

#format modes to bind with pairwise probs
tsl.dry.marsh.pond.modes.wide <- SEA.B.modes.matrix.t %>% as.data.frame() %>% 
  rownames_to_column(var = "Slough_Habitat_Season_SizeClass") %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season_SizeClass"), sep = "_") %>%
  separate(Season_SizeClass, into = c("Season", "Size Class"), sep = 3) %>% 
  mutate(`Size Class` = gsub("^.", "", `Size Class`)) %>% 
  mutate(Slough  = gsub("\\[[[0-9]+] ", "", Slough)) %>% 
  filter(Slough == "TSL", Habitat %in%  c("Marsh", "Pond"), Season == "Dry") %>% 
  pivot_wider(id_cols = `Size Class`, names_from = Habitat, values_from = mode) %>% 
  filter(!is.na(Marsh), !is.na(Pond))

tsl.dry.marsh.pond.direct.pairwise <- tsl.dry.marsh.pond.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Slough_Habitat_Season_SizeClass = rownames(tsl.dry.marsh.pond.pairwise)) %>% 
  separate(Slough_Habitat_Season_SizeClass, into = c("Slough", "Habitat", "Season", "Size Class"), sep = "_") %>% 
  filter(!`Size Class` %in% c("Green Algae", "FLOC", "PERMAT", "PEREPI")) %>% 
  merge(., tsl.dry.marsh.pond.modes.wide, by = "Size Class") %>% 
  select(`Size Class`, contains("Marsh"), contains("Pond"), everything()) %>% select(-c(Habitat)) %>% 
  rename(`Marsh < Pond` = ".") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Marsh < Pond` >= 0.95 ~ "Decrease",
      `Marsh < Pond` < 0.05 ~ "Increase",
      `Marsh < Pond` > 0.05 | `Marsh < Pond` < 0.95 ~ "No Change"),
    `Percent Change` = ((Pond-Marsh)/Marsh)*100,
    `Size Class` = case_when(
      `Size Class` == "AMPHIPOD" ~ "Amphipoda",
      `Size Class` == "BELSPP" ~ "Belostoma spp.",
      `Size Class` == "BRAGRA" ~ "B. gravida",
      `Size Class` == "COPEPOD" ~ "Copepoda",
      `Size Class` == "CHIRON" ~ "Chironomidae",
      `Size Class` == "COENAG" ~ "Coenagrionidae",
      `Size Class` == "CELSPP" ~ "Celithimus spp.",
      `Size Class` == "ERYSIM" ~ "E. simplicicollis",
      `Size Class` == "LIBINC" ~ "L. incesta",
      `Size Class` == "PALPAL" ~ "P. paludosus",
      `Size Class` == "PELFEM" ~ "P. femoratus",
      `Size Class` == "PLASCA" ~ "Planorbella spp.",
      `Size Class` == "PROFAL" ~ "P. fallax",
      `Size Class` == "PROALL" ~ "P. alleni",
      `Size Class` == "PROSPP" ~ "Procambarus spp.",
      TRUE ~ `Size Class`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Slough, Season, `Size Class`, Marsh, Pond, `Marsh < Pond`, `Percent Change`)

```

#### TSL Near Pond-Pond Dry Season Comparisons
No dry-season TSL near-pond data

#### Combine Habitat Comparisons
```{r}
#Marsh-NP
marsh.np.comparisons <- bind_rows(srs.wet.marsh.np.direct.pairwise, srs.dry.marsh.np.direct.pairwise, 
                                  tsl.wet.marsh.np.direct.pairwise)

#proportion of statistical changes in marsh-np comparisons
sum(marsh.np.comparisons$`Marsh < NP`>=0.95 | marsh.np.comparisons$`Marsh < NP`<=0.05)/nrow(marsh.np.comparisons) 

#mean and sd % change
marsh.np.comparisons %>% 
  filter(`Marsh < NP` >= 0.95 | `Marsh < NP` <= 0.05) %>% 
  mutate(`Percent Change` = abs(`Percent Change`)) %>% 
  summarize_at(.vars = "Percent Change", list(mean = mean,sd = sd))

#Marsh-Pond
marsh.pond.comparisons <- bind_rows(srs.wet.marsh.pond.direct.pairwise, srs.dry.marsh.pond.direct.pairwise, 
                                    tsl.wet.marsh.pond.direct.pairwise, tsl.dry.marsh.pond.direct.pairwise)

#proportion of statistical changes in marsh-pond comparisons
sum(marsh.pond.comparisons$`Marsh < Pond`>=0.95 | marsh.pond.comparisons$`Marsh < Pond`<=0.05)/nrow(marsh.pond.comparisons) 

#mean and sd % change
marsh.pond.comparisons %>% 
  filter(`Marsh < Pond` >= 0.95 | `Marsh < Pond` <= 0.05) %>% 
  mutate(`Percent Change` = abs(`Percent Change`)) %>% 
  summarize_at(.vars = "Percent Change", list(mean = mean, sd = sd))


#NP-Pond
np.pond.comparisons <- bind_rows(srs.wet.np.pond.direct.pairwise, srs.dry.np.pond.direct.pairwise, 
                                 tsl.wet.np.pond.direct.pairwise)

#proportion of statistical changes in marsh-np comparisons
sum(np.pond.comparisons$`NP < Pond`>=0.95 | np.pond.comparisons$`NP < Pond`<=0.05)/nrow(np.pond.comparisons) 

#mean and sd % change
np.pond.comparisons %>% 
  filter(`NP < Pond` >= 0.95 | `NP < Pond` <= 0.05) %>% 
  mutate(`Percent Change` = abs(`Percent Change`)) %>% 
  summarize_at(.vars = "Percent Change", list(mean = mean, sd = sd))

#combine into a list and export to Excel
habitat.comparisons <- list("Marsh-NP" = marsh.np.comparisons, "Marsh-Pond" = marsh.pond.comparisons, 
                            "NP-Pond" = np.pond.comparisons)

write.xlsx(habitat.comparisons, "habitat_comparisons.xlsx")
#proportion of all habitat comparisons that were statistically different
(
  sum(marsh.np.comparisons$`Marsh < NP`>=0.95 | marsh.np.comparisons$`Marsh < NP`<=0.05)+
    sum(marsh.pond.comparisons$`Marsh < Pond`>=0.95 | marsh.pond.comparisons$`Marsh < Pond`<=0.05)+
    sum(np.pond.comparisons$`NP < Pond`>=0.95 | np.pond.comparisons$`NP < Pond`<=0.05)
)/(
  nrow(marsh.np.comparisons)+nrow(marsh.pond.comparisons)+nrow(np.pond.comparisons)
)

#mean sd % change for all habitat comparisons
bind_rows(
  marsh.np.comparisons %>% rename(Comparison = `Marsh < NP`),
  marsh.pond.comparisons %>% rename(Comparison = `Marsh < Pond`),
  np.pond.comparisons %>% rename(Comparison = `NP < Pond`)) %>% 
  filter(Comparison >= 0.95 | Comparison <= 0.05) %>% 
  mutate(`Percent Change` = abs(`Percent Change`)) %>% 
  summarize_at(.vars = "Percent Change", list(mean = mean, sd = sd))
```

# Pre- vs Post-Invasion
## Load data
This file is output from 03_diets_from_stomach_contents.Rmd
```{r}
pre.post.invasion.stomachs <- read.csv("Outputs/Stomach Contents/Diet/Pre-vs-Post-Invasion/pre_post_nmds_consumers.csv") %>% 
  mutate(size_class = gsub("[//.]", "_", size_class))
```
## Format data for SIBER
```{r}
pre.post.siber.data <- pre.post.invasion.stomachs %>% 
  unite(community, c("Habitat", "Season", "Invasion_Status"), sep = "_") %>% 
  rename(group = size_class, iso1 = MDS1, iso2 = MDS2) %>% 
  select(iso1, iso2, group, community) %>% 
  group_by(group, community) %>% 
  filter(n()>2, sd(iso1)!=0, sd(iso2)!=0, !is.na(iso1), !is.na(iso2)) %>% 
  ungroup() %>% 
  as.data.frame() %>% 
  arrange(community, group)


#createSiberObject
pre.post.siber<-createSiberObject(pre.post.siber.data)

#write out samples sizes table
write.csv(pre.post.siber[["sample.sizes"]] %>% t(), 
          file = "Outputs/Stomach Contents/Diet/Pre-vs-Post-Invasion/siber_pre_post_stomachs_n_table.csv")
```

Visualize SIBER object
```{r}
# Create lists of plotting arguments to be passed onwards to each 
# of the three plotting functions.
community.hulls.args <- list(col = 1, lty = 1, lwd = 1)
group.ellipses.args  <- list(n = 100, p.interval = 0.95, lty = 1, lwd = 2)
group.hull.args      <- list(lty = 2, col = "grey20")

par(mfrow=c(1,1))
plotSiberObject(pre.post.siber,
                ax.pad = 2, 
                hulls = F, community.hulls.args, 
                ellipses = T, group.ellipses.args,
                group.hulls = T, group.hull.args,
                bty = "L",
                iso.order = c(1,2),
                xlab = expression(paste(delta^{13}, "C (\u2030)")),
                ylab = expression(paste(delta^{15}, "N (\u2030)"))
)

```
## Calculate TA, SEA, SEAc
```{r}
pre.post.ML <- groupMetricsML(pre.post.siber)
print(pre.post.ML)
write.csv(t(pre.post.ML), file = "Outputs/Stomach Contents/Diet/Pre-vs-Post-Invasion/pre_post_ML.csv")
```

## SIBER model
```{r}
#use the same model parameters
# fit the ellipses which uses an Inverse Wishart prior
# on the covariance matrix Sigma, and a vague normal prior on the 
# means. Fitting is via the JAGS method.
pre.post.ellipses.posterior <- siberMVN(pre.post.siber, parms, priors)

#calculate posterior estimates of ellipses for all groups
pre.post.SEA.B<-siberEllipses(pre.post.ellipses.posterior)
colnames(pre.post.SEA.B)<-names(pre.post.ellipses.posterior)
```

### Extract SIBER Output
```{r}
#calculate credibility intervals
cr.p<-c(0.5, 0.95, 0.99) #vector of desired quantiles

#call hdrcde_hdr using lapply()
pre.post.SEA.B.credibles<-lapply(
  as.data.frame(pre.post.SEA.B), 
  function(x,...){tmp<-hdrcde::hdr(x)$hdr},
  prob = cr.p)

#match up group names
names(pre.post.SEA.B.credibles)<-names(pre.post.ellipses.posterior)

#this carries through the row names from matrices in SEA.B.credibles
#they don't turn out all that clean though, so adding a column later with the same info
pre.post.y <- do.call(function(...) {
  tmp <- plyr::rbind.fill.matrix(...)
  rownames(tmp) <- sapply(pre.post.SEA.B.credibles, function(i) {
    rownames(i)
  })
  return(tmp)
}, pre.post.SEA.B.credibles)

pre.post.y

#object with cleaned-up row names
pre.post.interval<-rep(c("99%", "95%", "50%"), 196)

#replicated each name three times in sequence to match up with new data frame
pre.post.seab.names<-data.frame(rep(names(pre.post.SEA.B.credibles), each = 3))
colnames(pre.post.seab.names)<-"names"

#seab.names<-separate(seab.names, col = names, into = c('hab.season', 'spp'), extra = "merge")

#combine names with new data frame
pre.post.seab.cred.matrix<-data.frame(pre.post.seab.names, pre.post.interval, pre.post.y)
colnames(pre.post.seab.cred.matrix)<-c(colnames(pre.post.seab.names), "interval", "lower", "upper")

#write out to a csv
write.csv(pre.post.seab.cred.matrix, 
          file = "Outputs/Stomach Contents/Trophic Niche/Pre-vs-Post-Invasion/pre_post_SEAB_credibles.csv", 
          row.names = F)

# do similar to get the modes, taking care to pick up multimodal posterior
# distributions if present
pre.post.SEA.B.modes<-lapply(
  as.data.frame(pre.post.SEA.B), 
  function(x,...){tmp<-hdrcde::hdr(x)$mode},
  prob = cr.p, all.modes=T)

#need to do the same as for the credible intervals to get the colnames to be
#the names not the numbers
write.csv(pre.post.SEA.B.modes, file = "Outputs/Stomach Contents/Trophic Niche/Pre-vs-Post-Invasion/pre_post_SEAB_modes.csv")

#read back in
pre.post.SEA.B.modes.matrix<-read.csv(file = "Outputs/Stomach Contents/Trophic Niche/Pre-vs-Post-Invasion/pre_post_SEAB_modes.csv", header = T, row.names = 1)

#change colnames
colnames(pre.post.SEA.B.modes.matrix)<-names(pre.post.ellipses.posterior)
#transpose this matrix
pre.post.SEA.B.modes.matrix.t<-t(pre.post.SEA.B.modes.matrix) %>% as.data.frame()
#change the name of what is now a single column to mode
colnames(pre.post.SEA.B.modes.matrix.t)<-"Mode"
#write out the final csv over the previous mode csv
write.csv(pre.post.SEA.B.modes.matrix.t, 
          file = "Outputs/Stomach Contents/Trophic Niche/Pre-vs-Post-Invasion/pre_post_SEAB_modes.csv")
```

### Test Convergence
```{r}
#test convergence for all ellipses
pre.post.all.files <- dir(parms$save.dir, full.names = T)

#find which onces are jags model files
pre.post.model.files <- pre.post.all.files[grep("jags_output", pre.post.all.files)]

#test convergence 
do.this <- 1 #this number indicates which file, in order, is being looked at
load(pre.post.model.files[do.this])

gelman.diag(output, multivariate = F)
gelman.plot(output, auto.layout = F)

```

### Pre- vs Post-Invasion Pairwise Comparisons
```{r}
#turn the output into a list
pre.post.SEA.B.list <- as.list(as.data.frame(pre.post.SEA.B))

#use the pairwiseComparisons function from tRophicPosition package
pre.post.pairwise <- pairwiseComparisons(pre.post.SEA.B.list, print = F)
colnames(pre.post.pairwise) <- rownames(pre.post.pairwise)
#reformat data to have only pre-invasion and post-invasion comparstomachsns
pre.post.direct.pairwise <- pre.post.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Pre", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  arrange(Species) %>% 
  unite("Habitat_Season_Spp", c(Habitat, Season, Species), sep = "_") %>% 
  column_to_rownames(var = "Habitat_Season_Spp") %>% 
  select(-c(Invasion_Status)) %>% 
  t() %>% as.data.frame() %>% #Pre-Invasion is now the columns
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Post", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  arrange(Species) %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  unite("Habitat_Season_Spp", c(Habitat, Season, Species), sep = "_") %>% 
  filter(Habitat_Season_Spp %in% colnames(.)) %>% 
  column_to_rownames(var = "Habitat_Season_Spp") %>% 
  t() %>% as.data.frame() %>%  #Now Post-Invasion is the columns
  rownames_to_column(var = "Habitat_Season_Spp") %>% 
  filter(Habitat_Season_Spp %in% colnames(.)) %>% 
  column_to_rownames(var = "Habitat_Season_Spp")
#At the end Post-Invasion is the columns and Pre-Invasion is the rows
#The diagonal has Pre vs Post-Invasion comparisons within a habitat-season for a given size class
  
  
#format modes to bind with pairwise probs
pre.post.modes.wide <- pre.post.SEA.B.modes.matrix.t %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  pivot_wider(id_cols = Species, names_from = Invasion_Status, values_from = Mode) 

pre.post.direct.spp.pairwise <- pre.post.direct.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Species = rownames(pre.post.direct.pairwise)) %>% 
  separate(Species, into = c("Habitat", "Season", "Genus", "Species"), sep = "_") %>% 
  unite("Species", c(Genus, Species), sep = "_") %>% 
  merge(., pre.post.modes.wide, by = "Species") %>% 
  select(Species, contains("Invasion"), everything()) %>% select(-c(Habitat, Season)) %>% 
  rename(`Pre < Post` = ".") %>% 
  distinct(Species, .keep_all = T) %>% 
  separate(Species, into = c("Species", "Size Class"), sep = "(?<=[A-Za-z])(?=[0-9])") %>% 
  pivot_longer(cols = contains("Invasion"), names_to = "Habitat_Season_Invasion", values_to = "Mode") %>% 
  separate(Habitat_Season_Invasion, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  pivot_wider(names_from = "Invasion_Status", values_from = "Mode") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Pre < Post` >= 0.95 ~ "Increase",
      `Pre < Post` < 0.05 ~ "Decrease",
      `Pre < Post` > 0.05 | `Pre < Post` < 0.95 ~ "No Change"),
    `Percent Change` = ((Post-Pre)/Pre)*100,
    Species = case_when(
      Species == "A_nat" ~ "A. natalis",
      Species == "C_uro" ~ "M. urophthalmus",
      Species == "E_eve" ~ "E. evergladei",
      Species == "E_glo" ~ "E. gloriosus",
      Species == "F_chr" ~ "F. chrysotus",
      Species == "G_hol" ~ "G. holbrooki",
      Species == "H_for" ~ "H. formosa",
      Species == "J_flo" ~ "J. floridae",
      Species == "L_goo" ~ "L. goodei",
      Species == "L_gul" ~ "L. gulosus",
      Species == "L_mac" ~ "L. macrochirus",
      Species == "L_mar" ~ "L. marginatus",
      Species == "L_mic" ~ "L. microlophus",
      Species == "L_pun" ~ "L. punctatus",
      Species == "L_pla" ~ "L. platyrhincus",
      Species == "M_sal" ~ "M. salmoides",
      Species == "P_lat" ~ "P. latipinna",
      Species == "T_mar" ~ "P. mariae")) %>% 
  filter(!is.na(`Percent Change`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  arrange(Season, Habitat, Species) %>% 
  rename("Pre-Invasion" = Pre, "Post-Invasion" = Post) %>% 
  select(Season, Habitat, Species, `Size Class`, `Pre < Post`, `Pre-Invasion`, `Post-Invasion`, 
         Direction, `Percent Change`)

#write this out to excel
write.csv(pre.post.direct.spp.pairwise, 
          file = "Outputs/Stomach Contents/Trophic Niche/Pre-vs-Post-Invasion/pre_post_SEAB_prob_diff.csv",
          row.names = F)

#proportion of statistical changes in pre-post comparstomachsns
sum(pre.post.direct.spp.pairwise$`Pre < Post`>=0.95 | pre.post.direct.spp.pairwise$`Pre < Post`<=0.05)/nrow(pre.post.direct.spp.pairwise) 

#proportion of changes in the dry season
nrow(
  filter(pre.post.direct.spp.pairwise, 
         `Pre < Post` >= 0.95 | `Pre < Post` <= 0.05, Season == "Dry"))/
  nrow(
    filter(pre.post.direct.spp.pairwise, Season == "Dry")
  )

#dry season ponds
nrow(
  filter(pre.post.direct.spp.pairwise, 
         `Pre < Post` >= 0.95 | `Pre < Post` <= 0.05, Season == "Dry", Habitat == "Pond"))/
  nrow(
    filter(pre.post.direct.spp.pairwise, Season == "Dry", Habitat == "Pond")
  )

#dry season marsh
nrow(
  filter(pre.post.direct.spp.pairwise, 
         `Pre < Post` >= 0.95 | `Pre < Post` <= 0.05, Season == "Dry", Habitat == "Marsh"))/
  nrow(
    filter(pre.post.direct.spp.pairwise, Season == "Dry", Habitat == "Marsh")
  )

#proportion of changes in the Wet season
nrow(
  filter(pre.post.direct.spp.pairwise, 
         `Pre < Post` >= 0.95 | `Pre < Post` <= 0.05, Season == "Wet"))/
  nrow(
    filter(pre.post.direct.spp.pairwise, Season == "Wet")
  )

#Wet season ponds
nrow(
  filter(pre.post.direct.spp.pairwise, 
         `Pre < Post` >= 0.95 | `Pre < Post` <= 0.05, Season == "Wet", Habitat == "Pond"))/
  nrow(
    filter(pre.post.direct.spp.pairwise, Season == "Wet", Habitat == "Pond")
  )

#Wet season marsh
nrow(
  filter(pre.post.direct.spp.pairwise, 
         `Pre < Post` >= 0.95 | `Pre < Post` <= 0.05, Season == "Wet", Habitat == "Marsh"))/
  nrow(
    filter(pre.post.direct.spp.pairwise, Season == "Wet", Habitat == "Marsh")
  )
```

### Pre-Invasion Habitat and Season Comparisons
#### Pre-Invasion Marsh vs Pond Wet Season Comparisons
```{r}
#reformat data to have only pre-invasion wet-season pond-marsh comparisons
#diagonal will be comparisons within a size class
pre.marsh.pond.wet.direct.pairwise <- pre.post.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Pre", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Marsh", Season == "Wet") %>% 
  arrange(Species) %>% 
  select(-c(Habitat)) %>% 
  unite("Invasion_Season_Spp", c(Invasion_Status, Season, Species), sep = "_") %>% 
  column_to_rownames(var = "Invasion_Season_Spp") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Pre", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  arrange(Species) %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Pond", Season == "Wet") %>% 
  select(-c(Habitat)) %>% 
  unite("Invasion_Season_Spp", c(Invasion_Status, Season, Species), sep = "_") %>% 
  filter(Invasion_Season_Spp %in% colnames(.)) %>% 
  column_to_rownames(var = "Invasion_Season_Spp") %>% 
  t() %>% as.data.frame() %>%  
  rownames_to_column(var = "Invasion_Season_Spp") %>% 
  filter(Invasion_Season_Spp %in% colnames(.)) %>% 
  mutate(Habitat = "Pond") %>% 
  unite("Habitat_Invasion_Season_Spp", c(Habitat, Invasion_Season_Spp)) %>% 
  column_to_rownames(var = "Habitat_Invasion_Season_Spp") %>% 
  t() %>% as.data.frame() %>% 
  mutate(Habitat = "Marsh") %>% 
  rownames_to_column(var = "Invasion_Season_Spp") %>% 
  unite("Habitat_Invasion_Season_Spp", c(Habitat, Invasion_Season_Spp)) %>% 
  column_to_rownames(var = "Habitat_Invasion_Season_Spp")

#isolate comparisons within a spp size class
#reformat data
#calculate % change
pre.marsh.pond.wet.direct.spp.pairwise <- pre.marsh.pond.wet.direct.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Species = rownames(pre.marsh.pond.wet.direct.pairwise)) %>% 
  separate(Species, into = c("Habitat", "Invasion_Status", "Season", "Genus", "Species"), sep = "_") %>% 
  unite("Species", c(Genus, Species), sep = "_") %>% 
  merge(., pre.post.modes.wide, by = "Species") %>% 
  select(Species, ".", `Marsh_Wet_Pre-Invasion`, `Pond_Wet_Pre-Invasion`) %>% 
  rename(`Marsh < Pond` = ".") %>% 
  distinct(Species, .keep_all = T) %>% 
  separate(Species, into = c("Species", "Size Class"), sep = "(?<=[A-Za-z])(?=[0-9])") %>% 
  pivot_longer(cols = contains("Invasion"), names_to = "Habitat_Season_Invasion", values_to = "Mode") %>% 
  separate(Habitat_Season_Invasion, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  pivot_wider(names_from = "Habitat", values_from = "Mode") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Marsh < Pond` >= 0.95 ~ "Increase",
      `Marsh < Pond` < 0.05 ~ "Decrease",
      `Marsh < Pond` > 0.05 | `Marsh < Pond` < 0.95 ~ "No Change"),
    `Percent Change` = ((Pond-Marsh)/Marsh)*100,
    Species = case_when(
      Species == "A_nat" ~ "A. natalis",
      #Species == "C_uro" ~ "M. urophthalmus",
      Species == "E_eve" ~ "E. evergladei",
      #Species == "E_glo" ~ "E. gloriosus",
      Species == "F_chr" ~ "F. chrysotus",
      Species == "F_con" ~ "F. confluentus",
      Species == "G_hol" ~ "G. holbrooki",
      Species == "H_for" ~ "H. formosa",
      Species == "J_flo" ~ "J. floridae",
      Species == "L_goo" ~ "L. goodei",
      Species == "L_gul" ~ "L. gulosus",
      #Species == "L_mac" ~ "L. macrochirus",
      Species == "L_mar" ~ "L. marginatus",
      #Species == "L_mic" ~ "L. microlophus",
      Species == "L_pun" ~ "L. punctatus",
      #Species == "L_pla" ~ "L. platyrhincus",
      #Species == "M_sal" ~ "M. salmoides",
      Species == "N_gyr" ~ "N. gyrinus"
      #Species == "P_lat" ~ "P. latipinna",
      #Species == "T_mar" ~ "P. mariae"
      )) %>% 
  filter(!is.na(`Percent Change`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Invasion_Status, Season, Species, `Size Class`, Marsh, Pond, `Marsh < Pond`, 
         Direction, `Percent Change`)
```

#### Pre-Invasion Marsh vs Pond Dry Season Comparisons
```{r}
#reformat data to have only pre-invasion Dry-season pond-marsh comparisons
#diagonal will be comparisons within a size class
pre.marsh.pond.Dry.direct.pairwise <- pre.post.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Pre", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Marsh", Season == "Dry") %>% 
  arrange(Species) %>% 
  select(-c(Habitat)) %>% 
  unite("Invasion_Season_Spp", c(Invasion_Status, Season, Species), sep = "_") %>% 
  column_to_rownames(var = "Invasion_Season_Spp") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Pre", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  arrange(Species) %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Pond", Season == "Dry") %>% 
  select(-c(Habitat)) %>% 
  unite("Invasion_Season_Spp", c(Invasion_Status, Season, Species), sep = "_") %>% 
  filter(Invasion_Season_Spp %in% colnames(.)) %>% 
  column_to_rownames(var = "Invasion_Season_Spp") %>% 
  t() %>% as.data.frame() %>%  
  rownames_to_column(var = "Invasion_Season_Spp") %>% 
  filter(Invasion_Season_Spp %in% colnames(.)) %>% 
  mutate(Habitat = "Pond") %>% 
  unite("Habitat_Invasion_Season_Spp", c(Habitat, Invasion_Season_Spp)) %>% 
  column_to_rownames(var = "Habitat_Invasion_Season_Spp") %>% 
  t() %>% as.data.frame() %>% 
  mutate(Habitat = "Marsh") %>% 
  rownames_to_column(var = "Invasion_Season_Spp") %>% 
  unite("Habitat_Invasion_Season_Spp", c(Habitat, Invasion_Season_Spp)) %>% 
  column_to_rownames(var = "Habitat_Invasion_Season_Spp")

#isolate comparisons within a spp size class
#reformat data
#calculate % change
pre.marsh.pond.Dry.direct.spp.pairwise <- pre.marsh.pond.Dry.direct.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Species = rownames(pre.marsh.pond.Dry.direct.pairwise)) %>% 
  separate(Species, into = c("Habitat", "Invasion_Status", "Season", "Genus", "Species"), sep = "_") %>% 
  unite("Species", c(Genus, Species), sep = "_") %>% 
  merge(., pre.post.modes.wide, by = "Species") %>% 
  select(Species, ".", `Marsh_Dry_Pre-Invasion`, `Pond_Dry_Pre-Invasion`) %>% 
  rename(`Marsh < Pond` = ".") %>% 
  distinct(Species, .keep_all = T) %>% 
  separate(Species, into = c("Species", "Size Class"), sep = "(?<=[A-Za-z])(?=[0-9])") %>% 
  pivot_longer(cols = contains("Invasion"), names_to = "Habitat_Season_Invasion", values_to = "Mode") %>% 
  separate(Habitat_Season_Invasion, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  pivot_wider(names_from = "Habitat", values_from = "Mode") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Marsh < Pond` >= 0.95 ~ "Increase",
      `Marsh < Pond` < 0.05 ~ "Decrease",
      `Marsh < Pond` > 0.05 | `Marsh < Pond` < 0.95 ~ "No Change"),
    `Percent Change` = ((Pond-Marsh)/Marsh)*100,
    Species = case_when(
      Species == "A_nat" ~ "A. natalis",
      #Species == "C_uro" ~ "M. urophthalmus",
      Species == "E_eve" ~ "E. evergladei",
      #Species == "E_glo" ~ "E. gloriosus",
      Species == "F_chr" ~ "F. chrysotus",
      #Species == "F_con" ~ "F. confluentus",
      Species == "G_hol" ~ "G. holbrooki",
      Species == "H_for" ~ "H. formosa",
      #Species == "J_flo" ~ "J. floridae",
      #Species == "L_goo" ~ "L. goodei",
     # Species == "L_gul" ~ "L. gulosus",
      #Species == "L_mac" ~ "L. macrochirus",
      Species == "L_mar" ~ "L. marginatus",
      #Species == "L_mic" ~ "L. microlophus",
      Species == "L_pun" ~ "L. punctatus",
      #Species == "L_pla" ~ "L. platyrhincus",
      #Species == "M_sal" ~ "M. salmoides",
      Species == "N_gyr" ~ "N. gyrinus",
      Species == "P_lat" ~ "P. latipinna"
      #Species == "T_mar" ~ "P. mariae"
    )) %>% 
  filter(!is.na(`Percent Change`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Invasion_Status, Season, Species, `Size Class`, Marsh, Pond, `Marsh < Pond`, 
         Direction, `Percent Change`)
```

#### Pre-Invasion Wet vs Dry Marsh Comparisons
```{r}
#reformat data to have only pre-invasion wet-season pond-marsh comparisons
#diagonal will be comparisons within a size class
pre.marsh.wet.dry.direct.pairwise <- pre.post.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Pre", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Marsh", Season == "Wet") %>% 
  arrange(Species) %>% 
  select(-c(Season)) %>% 
  unite("Invasion_Habitat_Spp", c(Invasion_Status, Habitat, Species), sep = "_") %>% 
  column_to_rownames(var = "Invasion_Habitat_Spp") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Pre", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  arrange(Species) %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Marsh", Season == "Dry") %>% 
  select(-c(Season)) %>% 
  unite("Invasion_Habitat_Spp", c(Invasion_Status, Habitat, Species), sep = "_") %>% 
  filter(Invasion_Habitat_Spp %in% colnames(.)) %>% 
  column_to_rownames(var = "Invasion_Habitat_Spp") %>% 
  t() %>% as.data.frame() %>%  
  rownames_to_column(var = "Invasion_Habitat_Spp") %>% 
  filter(Invasion_Habitat_Spp %in% colnames(.)) %>% 
  mutate(Season = "Dry") %>% 
  unite("Season_Invasion_Habitat_Spp", c(Season, Invasion_Habitat_Spp)) %>% 
  column_to_rownames(var = "Season_Invasion_Habitat_Spp") %>% 
  t() %>% as.data.frame() %>% 
  mutate(Season = "Wet") %>% 
  rownames_to_column(var = "Invasion_Habitat_Spp") %>% 
  unite("Season_Invasion_Habitat_Spp", c(Season, Invasion_Habitat_Spp)) %>% 
  column_to_rownames(var = "Season_Invasion_Habitat_Spp")

#isolate comparisons within a spp size class
#reformat data
#calculate % change
pre.marsh.wet.dry.direct.spp.pairwise <- pre.marsh.wet.dry.direct.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Species = rownames(pre.marsh.wet.dry.direct.pairwise)) %>% 
  separate(Species, into = c("Habitat", "Invasion_Status", "Season", "Genus", "Species"), sep = "_") %>% 
  unite("Species", c(Genus, Species), sep = "_") %>% 
  merge(., pre.post.modes.wide, by = "Species") %>% 
  select(Species, ".", `Marsh_Wet_Pre-Invasion`, `Marsh_Dry_Pre-Invasion`) %>% 
  rename(`Wet < Dry` = ".") %>% 
  distinct(Species, .keep_all = T) %>% 
  separate(Species, into = c("Species", "Size Class"), sep = "(?<=[A-Za-z])(?=[0-9])") %>% 
  pivot_longer(cols = contains("Invasion"), names_to = "Habitat_Season_Invasion", values_to = "Mode") %>% 
  separate(Habitat_Season_Invasion, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  pivot_wider(names_from = "Season", values_from = "Mode") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Wet < Dry` >= 0.95 ~ "Increase",
      `Wet < Dry` < 0.05 ~ "Decrease",
      `Wet < Dry` > 0.05 | `Wet < Dry` < 0.95 ~ "No Change"),
    `Percent Change` = ((Dry-Wet)/Wet)*100,
    Species = case_when(
      Species == "A_nat" ~ "A. natalis",
      Species == "C_var" ~ "C. variegatus",
      #Species == "C_uro" ~ "M. urophthalmus",
      Species == "E_eve" ~ "E. evergladei",
      Species == "E_glo" ~ "E. gloriosus",
      Species == "F_chr" ~ "F. chrysotus",
      Species == "F_con" ~ "F. confluentus",
      Species == "G_hol" ~ "G. holbrooki",
      Species == "H_for" ~ "H. formosa",
      Species == "J_flo" ~ "J. floridae",
      Species == "L_goo" ~ "L. goodei",
      #Species == "L_gul" ~ "L. gulosus",
      #Species == "L_mac" ~ "L. macrochirus",
      Species == "L_mar" ~ "L. marginatus",
      #Species == "L_mic" ~ "L. microlophus",
      Species == "L_pun" ~ "L. punctatus",
      #Species == "L_pla" ~ "L. platyrhincus",
      #Species == "M_sal" ~ "M. salmoides",
      Species == "N_gyr" ~ "N. gyrinus",
      Species == "P_lat" ~ "P. latipinna"
      #Species == "T_mar" ~ "P. mariae"
    )) %>% 
  filter(!is.na(`Percent Change`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Invasion_Status, Habitat, Species, `Size Class`, Wet, Dry, `Wet < Dry`, 
         Direction, `Percent Change`)
```

#### Pre-Invasion Wet vs Dry Pond Comparisons
```{r}
#reformat data to have only pre-invasion wet-season pond-Pond comparisons
#diagonal will be comparisons within a size class
pre.pond.wet.dry.direct.pairwise <- pre.post.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Pre", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Pond", Season == "Wet") %>% 
  arrange(Species) %>% 
  select(-c(Season)) %>% 
  unite("Invasion_Habitat_Spp", c(Invasion_Status, Habitat, Species), sep = "_") %>% 
  column_to_rownames(var = "Invasion_Habitat_Spp") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Pre", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  arrange(Species) %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Pond", Season == "Dry") %>% 
  select(-c(Season)) %>% 
  unite("Invasion_Habitat_Spp", c(Invasion_Status, Habitat, Species), sep = "_") %>% 
  filter(Invasion_Habitat_Spp %in% colnames(.)) %>% 
  column_to_rownames(var = "Invasion_Habitat_Spp") %>% 
  t() %>% as.data.frame() %>%  
  rownames_to_column(var = "Invasion_Habitat_Spp") %>% 
  filter(Invasion_Habitat_Spp %in% colnames(.)) %>% 
  mutate(Season = "Dry") %>% 
  unite("Season_Invasion_Habitat_Spp", c(Season, Invasion_Habitat_Spp)) %>% 
  column_to_rownames(var = "Season_Invasion_Habitat_Spp") %>% 
  t() %>% as.data.frame() %>% 
  mutate(Season = "Wet") %>% 
  rownames_to_column(var = "Invasion_Habitat_Spp") %>% 
  unite("Season_Invasion_Habitat_Spp", c(Season, Invasion_Habitat_Spp)) %>% 
  column_to_rownames(var = "Season_Invasion_Habitat_Spp")

#isolate comparisons within a spp size class
#reformat data
#calculate % change
pre.pond.wet.dry.direct.spp.pairwise <- pre.pond.wet.dry.direct.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Species = rownames(pre.pond.wet.dry.direct.pairwise)) %>% 
  separate(Species, into = c("Habitat", "Invasion_Status", "Season", "Genus", "Species"), sep = "_") %>% 
  unite("Species", c(Genus, Species), sep = "_") %>% 
  merge(., pre.post.modes.wide, by = "Species") %>% 
  select(Species, ".", `Pond_Wet_Pre-Invasion`, `Pond_Dry_Pre-Invasion`) %>% 
  rename(`Wet < Dry` = ".") %>% 
  distinct(Species, .keep_all = T) %>% 
  separate(Species, into = c("Species", "Size Class"), sep = "(?<=[A-Za-z])(?=[0-9])") %>% 
  pivot_longer(cols = contains("Invasion"), names_to = "Habitat_Season_Invasion", values_to = "Mode") %>% 
  separate(Habitat_Season_Invasion, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  pivot_wider(names_from = "Season", values_from = "Mode") %>% 
  mutate(#`Pre > Post` = 1 - `Pre < Post`,
    Direction = case_when(
      `Wet < Dry` >= 0.95 ~ "Increase",
      `Wet < Dry` < 0.05 ~ "Decrease",
      `Wet < Dry` > 0.05 | `Wet < Dry` < 0.95 ~ "No Change"),
    `Percent Change` = ((Dry-Wet)/Wet)*100,
    Species = case_when(
      Species == "A_nat" ~ "A. natalis",
      Species == "B_bel" ~ "B. belizanus",
      Species == "C_bat" ~ "C. batrachus",
      #Species == "C_var" ~ "C. variegatus",
      #Species == "C_uro" ~ "M. urophthalmus",
      Species == "E_eve" ~ "E. evergladei",
      #Species == "E_glo" ~ "E. gloriosus",
      Species == "F_chr" ~ "F. chrysotus",
      #Species == "F_con" ~ "F. confluentus",
      Species == "G_hol" ~ "G. holbrooki",
      Species == "H_for" ~ "H. formosa",
      #Species == "J_flo" ~ "J. floridae",
      #Species == "L_goo" ~ "L. goodei",
      Species == "L_gul" ~ "L. gulosus",
      Species == "L_mac" ~ "L. macrochirus",
      Species == "L_mar" ~ "L. marginatus",
      #Species == "L_mic" ~ "L. microlophus",
      Species == "L_pun" ~ "L. punctatus",
      Species == "L_pla" ~ "L. platyrhincus",
      #Species == "M_sal" ~ "M. salmoides",
      Species == "N_gyr" ~ "N. gyrinus"
      #Species == "P_lat" ~ "P. latipinna"
      #Species == "T_mar" ~ "P. mariae"
    )) %>% 
  filter(!is.na(`Percent Change`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Invasion_Status, Habitat, Species, `Size Class`, Wet, Dry, `Wet < Dry`, 
         Direction, `Percent Change`)
```

#### Post-Invasion Marsh vs Pond Wet Seaosn Comparisons
```{r}
#reformat data to have only Post-invasion wet-season pond-marsh comparisons
#diagonal will be comparisons within a size class
post.marsh.pond.wet.direct.pairwise <- pre.post.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Post", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Marsh", Season == "Wet") %>% 
  arrange(Species) %>% 
  select(-c(Habitat)) %>% 
  unite("Invasion_Season_Spp", c(Invasion_Status, Season, Species), sep = "_") %>% 
  column_to_rownames(var = "Invasion_Season_Spp") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Post", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  arrange(Species) %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Pond", Season == "Wet") %>% 
  select(-c(Habitat)) %>% 
  unite("Invasion_Season_Spp", c(Invasion_Status, Season, Species), sep = "_") %>% 
  filter(Invasion_Season_Spp %in% colnames(.)) %>% 
  column_to_rownames(var = "Invasion_Season_Spp") %>% 
  t() %>% as.data.frame() %>%  
  rownames_to_column(var = "Invasion_Season_Spp") %>% 
  filter(Invasion_Season_Spp %in% colnames(.)) %>% 
  mutate(Habitat = "Pond") %>% 
  unite("Habitat_Invasion_Season_Spp", c(Habitat, Invasion_Season_Spp)) %>% 
  column_to_rownames(var = "Habitat_Invasion_Season_Spp") %>% 
  t() %>% as.data.frame() %>% 
  mutate(Habitat = "Marsh") %>% 
  rownames_to_column(var = "Invasion_Season_Spp") %>% 
  unite("Habitat_Invasion_Season_Spp", c(Habitat, Invasion_Season_Spp)) %>% 
  column_to_rownames(var = "Habitat_Invasion_Season_Spp")

#isolate comparisons within a spp size class
#reformat data
#calculate % change
post.marsh.pond.wet.direct.spp.pairwise <- post.marsh.pond.wet.direct.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Species = rownames(post.marsh.pond.wet.direct.pairwise)) %>% 
  separate(Species, into = c("Habitat", "Invasion_Status", "Season", "Genus", "Species"), sep = "_") %>% 
  unite("Species", c(Genus, Species), sep = "_") %>% 
  merge(., pre.post.modes.wide, by = "Species") %>% 
  select(Species, ".", `Marsh_Wet_Post-Invasion`, `Pond_Wet_Post-Invasion`) %>% 
  rename(`Marsh < Pond` = ".") %>% 
  distinct(Species, .keep_all = T) %>% 
  separate(Species, into = c("Species", "Size Class"), sep = "(?<=[A-Za-z])(?=[0-9])") %>% 
  pivot_longer(cols = contains("Invasion"), names_to = "Habitat_Season_Invasion", values_to = "Mode") %>% 
  separate(Habitat_Season_Invasion, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  pivot_wider(names_from = "Habitat", values_from = "Mode") %>% 
  mutate(#`Post > Post` = 1 - `Post < Post`,
    Direction = case_when(
      `Marsh < Pond` >= 0.95 ~ "Increase",
      `Marsh < Pond` < 0.05 ~ "Decrease",
      `Marsh < Pond` > 0.05 | `Marsh < Pond` < 0.95 ~ "No Change"),
    `Percent Change` = ((Pond-Marsh)/Marsh)*100,
    Species = case_when(
      #Species == "A_nat" ~ "A. natalis",
      Species == "C_uro" ~ "M. urophthalmus",
      #Species == "E_eve" ~ "E. evergladei",
      #Species == "E_glo" ~ "E. gloriosus",
      Species == "E_suc" ~ "E. sucetta",
      Species == "F_chr" ~ "F. chrysotus",
      #Species == "F_con" ~ "F. confluentus",
      Species == "G_hol" ~ "G. holbrooki",
      Species == "H_for" ~ "H. formosa",
      Species == "H_let" ~ "H. letourneuxi",
      Species == "J_flo" ~ "J. floridae",
      Species == "L_goo" ~ "L. goodei",
      Species == "L_gul" ~ "L. gulosus",
      Species == "L_mac" ~ "L. macrochirus",
      #Species == "L_mar" ~ "L. marginatus",
      Species == "L_mic" ~ "L. microlophus",
      Species == "L_pun" ~ "L. punctatus",
      #Species == "L_pla" ~ "L. platyrhincus",
      #Species == "M_sal" ~ "M. salmoides",
      Species == "N_gyr" ~ "N. gyrinus",
      Species == "O_aur" ~ "O. aureus"
      #Species == "P_lat" ~ "P. latipinna",
      #Species == "T_mar" ~ "P. mariae"
    )) %>% 
  filter(!is.na(`Percent Change`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Invasion_Status, Season, Species, `Size Class`, Marsh, Pond, `Marsh < Pond`, 
         Direction, `Percent Change`)

```

#### Post-Invasion Marsh vs Pond Dry Season Comparisons
```{r}
#reformat data to have only Post-invasion Dry-season pond-marsh comparisons
#diagonal will be comparisons within a size class
post.marsh.pond.dry.direct.pairwise <- pre.post.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Post", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Marsh", Season == "Dry") %>% 
  arrange(Species) %>% 
  select(-c(Habitat)) %>% 
  unite("Invasion_Season_Spp", c(Invasion_Status, Season, Species), sep = "_") %>% 
  column_to_rownames(var = "Invasion_Season_Spp") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Post", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  arrange(Species) %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Pond", Season == "Dry") %>% 
  select(-c(Habitat)) %>% 
  unite("Invasion_Season_Spp", c(Invasion_Status, Season, Species), sep = "_") %>% 
  filter(Invasion_Season_Spp %in% colnames(.)) %>% 
  column_to_rownames(var = "Invasion_Season_Spp") %>% 
  t() %>% as.data.frame() %>%  
  rownames_to_column(var = "Invasion_Season_Spp") %>% 
  filter(Invasion_Season_Spp %in% colnames(.)) %>% 
  mutate(Habitat = "Pond") %>% 
  unite("Habitat_Invasion_Season_Spp", c(Habitat, Invasion_Season_Spp)) %>% 
  column_to_rownames(var = "Habitat_Invasion_Season_Spp") %>% 
  t() %>% as.data.frame() %>% 
  mutate(Habitat = "Marsh") %>% 
  rownames_to_column(var = "Invasion_Season_Spp") %>% 
  unite("Habitat_Invasion_Season_Spp", c(Habitat, Invasion_Season_Spp)) %>% 
  column_to_rownames(var = "Habitat_Invasion_Season_Spp")

#isolate comparisons within a spp size class
#reformat data
#calculate % change
post.marsh.pond.dry.direct.spp.pairwise <- post.marsh.pond.dry.direct.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Species = rownames(post.marsh.pond.dry.direct.pairwise)) %>% 
  separate(Species, into = c("Habitat", "Invasion_Status", "Season", "Genus", "Species"), sep = "_") %>% 
  unite("Species", c(Genus, Species), sep = "_") %>% 
  merge(., pre.post.modes.wide, by = "Species") %>% 
  select(Species, ".", `Marsh_Dry_Post-Invasion`, `Pond_Dry_Post-Invasion`) %>% 
  rename(`Marsh < Pond` = ".") %>% 
  distinct(Species, .keep_all = T) %>% 
  separate(Species, into = c("Species", "Size Class"), sep = "(?<=[A-Za-z])(?=[0-9])") %>% 
  pivot_longer(cols = contains("Invasion"), names_to = "Habitat_Season_Invasion", values_to = "Mode") %>% 
  separate(Habitat_Season_Invasion, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  pivot_wider(names_from = "Habitat", values_from = "Mode") %>% 
  mutate(#`Post > Post` = 1 - `Post < Post`,
    Direction = case_when(
      `Marsh < Pond` >= 0.95 ~ "Increase",
      `Marsh < Pond` < 0.05 ~ "Decrease",
      `Marsh < Pond` > 0.05 | `Marsh < Pond` < 0.95 ~ "No Change"),
    `Percent Change` = ((Pond-Marsh)/Marsh)*100,
    Species = case_when(
      #Species == "A_nat" ~ "A. natalis",
      #Species == "C_uro" ~ "M. urophthalmus",
      #Species == "E_eve" ~ "E. evergladei",
      #Species == "E_glo" ~ "E. gloriosus",
      Species == "F_chr" ~ "F. chrysotus",
      #Species == "F_con" ~ "F. confluentus",
      Species == "G_hol" ~ "G. holbrooki",
      Species == "H_for" ~ "H. formosa",
      Species == "H_lit" ~ "H. littorale", 
      #Species == "J_flo" ~ "J. floridae",
      Species == "L_goo" ~ "L. goodei",
      # Species == "L_gul" ~ "L. gulosus",
      #Species == "L_mac" ~ "L. macrochirus",
      Species == "L_mar" ~ "L. marginatus",
      #Species == "L_mic" ~ "L. microlophus",
      Species == "L_pun" ~ "L. punctatus"
      #Species == "L_pla" ~ "L. platyrhincus",
      #Species == "M_sal" ~ "M. salmoides",
      #Species == "N_gyr" ~ "N. gyrinus",
      #Species == "P_lat" ~ "P. latipinna"
      #Species == "T_mar" ~ "P. mariae"
    )) %>% 
  filter(!is.na(`Percent Change`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Invasion_Status, Season, Species, `Size Class`, Marsh, Pond, `Marsh < Pond`, 
         Direction, `Percent Change`)
```

#### Post-Invasion Wet vs Dry Marsh Comparisons
```{r}
#reformat data to have only Post-invasion wet-season pond-marsh comparisons
#diagonal will be comparisons within a size class
post.marsh.wet.dry.direct.pairwise <- pre.post.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Post", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Marsh", Season == "Wet") %>% 
  arrange(Species) %>% 
  select(-c(Season)) %>% 
  unite("Invasion_Habitat_Spp", c(Invasion_Status, Habitat, Species), sep = "_") %>% 
  column_to_rownames(var = "Invasion_Habitat_Spp") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Post", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  arrange(Species) %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Marsh", Season == "Dry") %>% 
  select(-c(Season)) %>% 
  unite("Invasion_Habitat_Spp", c(Invasion_Status, Habitat, Species), sep = "_") %>% 
  filter(Invasion_Habitat_Spp %in% colnames(.)) %>% 
  column_to_rownames(var = "Invasion_Habitat_Spp") %>% 
  t() %>% as.data.frame() %>%  
  rownames_to_column(var = "Invasion_Habitat_Spp") %>% 
  filter(Invasion_Habitat_Spp %in% colnames(.)) %>% 
  mutate(Season = "Dry") %>% 
  unite("Season_Invasion_Habitat_Spp", c(Season, Invasion_Habitat_Spp)) %>% 
  column_to_rownames(var = "Season_Invasion_Habitat_Spp") %>% 
  t() %>% as.data.frame() %>% 
  mutate(Season = "Wet") %>% 
  rownames_to_column(var = "Invasion_Habitat_Spp") %>% 
  unite("Season_Invasion_Habitat_Spp", c(Season, Invasion_Habitat_Spp)) %>% 
  column_to_rownames(var = "Season_Invasion_Habitat_Spp")

#isolate comparisons within a spp size class
#reformat data
#calculate % change
post.marsh.wet.dry.direct.spp.pairwise <- post.marsh.wet.dry.direct.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Species = rownames(post.marsh.wet.dry.direct.pairwise)) %>% 
  separate(Species, into = c("Habitat", "Invasion_Status", "Season", "Genus", "Species"), sep = "_") %>% 
  unite("Species", c(Genus, Species), sep = "_") %>% 
  merge(., pre.post.modes.wide, by = "Species") %>% 
  select(Species, ".", `Marsh_Wet_Post-Invasion`, `Marsh_Dry_Post-Invasion`) %>% 
  rename(`Wet < Dry` = ".") %>% 
  distinct(Species, .keep_all = T) %>% 
  separate(Species, into = c("Species", "Size Class"), sep = "(?<=[A-Za-z])(?=[0-9])") %>% 
  pivot_longer(cols = contains("Invasion"), names_to = "Habitat_Season_Invasion", values_to = "Mode") %>% 
  separate(Habitat_Season_Invasion, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  pivot_wider(names_from = "Season", values_from = "Mode") %>% 
  mutate(#`Post > Post` = 1 - `Post < Post`,
    Direction = case_when(
      `Wet < Dry` >= 0.95 ~ "Increase",
      `Wet < Dry` < 0.05 ~ "Decrease",
      `Wet < Dry` > 0.05 | `Wet < Dry` < 0.95 ~ "No Change"),
    `Percent Change` = ((Dry-Wet)/Wet)*100,
    Species = case_when(
      #Species == "A_nat" ~ "A. natalis",
      #Species == "C_var" ~ "C. variegatus",
      Species == "C_uro" ~ "M. urophthalmus",
      #Species == "E_eve" ~ "E. evergladei",
      Species == "E_suc" ~ "E. sucetta", 
      #Species == "E_glo" ~ "E. gloriosus",
      Species == "F_chr" ~ "F. chrysotus",
      #Species == "F_con" ~ "F. confluentus",
      Species == "G_hol" ~ "G. holbrooki",
      Species == "H_for" ~ "H. formosa",
      Species == "H_let" ~ "H. letourneuxi",
      #Species == "J_flo" ~ "J. floridae",
      Species == "L_goo" ~ "L. goodei",
      #Species == "L_gul" ~ "L. gulosus",
      #Species == "L_mac" ~ "L. macrochirus",
      #Species == "L_mar" ~ "L. marginatus",
      #Species == "L_mic" ~ "L. microlophus",
      Species == "L_pun" ~ "L. punctatus"
      #Species == "L_pla" ~ "L. platyrhincus",
      #Species == "M_sal" ~ "M. salmoides",
      #Species == "N_gyr" ~ "N. gyrinus",
      #Species == "P_lat" ~ "P. latipinna"
      #Species == "T_mar" ~ "P. mariae"
    )) %>% 
  filter(!is.na(`Percent Change`)) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  arrange(Species) %>% 
  select(Invasion_Status, Habitat, Species, `Size Class`, Wet, Dry, `Wet < Dry`, 
         Direction, `Percent Change`)
```

#### Post-Invasion Wet vs Dry Pond Comparisons
```{r}
#reformat data to have only Post-invasion wet-season pond-Pond comparisons
#diagonal will be comparisons within a size class
post.pond.wet.dry.direct.pairwise <- pre.post.pairwise %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Post", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Pond", Season == "Wet") %>% 
  arrange(Species) %>% 
  select(-c(Season)) %>% 
  unite("Invasion_Habitat_Spp", c(Invasion_Status, Habitat, Species), sep = "_") %>% 
  column_to_rownames(var = "Invasion_Habitat_Spp") %>% 
  t() %>% as.data.frame() %>% 
  rownames_to_column(var = "Invasion_Status_Spp") %>% 
  filter(grepl("Post", Invasion_Status_Spp)) %>% 
  separate(Invasion_Status_Spp, into = c("Invasion_Status", "Species"), sep = "[//.]") %>% 
  arrange(Species) %>% 
  mutate(Invasion_Status  = gsub("\\[[[0-9]+] ", "", Invasion_Status)) %>% 
  separate(Invasion_Status, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  filter(Habitat == "Pond", Season == "Dry") %>% 
  select(-c(Season)) %>% 
  unite("Invasion_Habitat_Spp", c(Invasion_Status, Habitat, Species), sep = "_") %>% 
  filter(Invasion_Habitat_Spp %in% colnames(.)) %>% 
  column_to_rownames(var = "Invasion_Habitat_Spp") %>% 
  t() %>% as.data.frame() %>%  
  rownames_to_column(var = "Invasion_Habitat_Spp") %>% 
  filter(Invasion_Habitat_Spp %in% colnames(.)) %>% 
  mutate(Season = "Dry") %>% 
  unite("Season_Invasion_Habitat_Spp", c(Season, Invasion_Habitat_Spp)) %>% 
  column_to_rownames(var = "Season_Invasion_Habitat_Spp") %>% 
  t() %>% as.data.frame() %>% 
  mutate(Season = "Wet") %>% 
  rownames_to_column(var = "Invasion_Habitat_Spp") %>% 
  unite("Season_Invasion_Habitat_Spp", c(Season, Invasion_Habitat_Spp)) %>% 
  column_to_rownames(var = "Season_Invasion_Habitat_Spp")

#isolate comparisons within a spp size class
#reformat data
#calculate % change
post.pond.wet.dry.direct.spp.pairwise <- post.pond.wet.dry.direct.pairwise %>% as.matrix() %>% 
  diag() %>% as.data.frame() %>% 
  mutate(Species = rownames(post.pond.wet.dry.direct.pairwise)) %>% 
  separate(Species, into = c("Habitat", "Invasion_Status", "Season", "Genus", "Species"), sep = "_") %>% 
  unite("Species", c(Genus, Species), sep = "_") %>% 
  merge(., pre.post.modes.wide, by = "Species") %>% 
  select(Species, ".", `Pond_Wet_Post-Invasion`, `Pond_Dry_Post-Invasion`) %>% 
  rename(`Wet < Dry` = ".") %>% 
  distinct(Species, .keep_all = T) %>% 
  separate(Species, into = c("Species", "Size Class"), sep = "(?<=[A-Za-z])(?=[0-9])") %>% 
  pivot_longer(cols = contains("Invasion"), names_to = "Habitat_Season_Invasion", values_to = "Mode") %>% 
  separate(Habitat_Season_Invasion, into = c("Habitat", "Season", "Invasion_Status")) %>% 
  pivot_wider(names_from = "Season", values_from = "Mode") %>% 
  mutate(#`Post > Post` = 1 - `Post < Post`,
    Direction = case_when(
      `Wet < Dry` >= 0.95 ~ "Increase",
      `Wet < Dry` < 0.05 ~ "Decrease",
      `Wet < Dry` > 0.05 | `Wet < Dry` < 0.95 ~ "No Change"),
    `Percent Change` = ((Dry-Wet)/Wet)*100,
    Species = case_when(
      #Species == "A_nat" ~ "A. natalis",
      #Species == "B_bel" ~ "B. belizanus",
      #Species == "C_bat" ~ "C. batrachus",
      #Species == "C_var" ~ "C. variegatus",
      #Species == "C_uro" ~ "M. urophthalmus",
      #Species == "E_eve" ~ "E. evergladei",
      #Species == "E_glo" ~ "E. gloriosus",
      Species == "F_chr" ~ "F. chrysotus",
      #Species == "F_con" ~ "F. confluentus",
      Species == "G_hol" ~ "G. holbrooki",
      Species == "H_for" ~ "H. formosa",
      #Species == "J_flo" ~ "J. floridae",
      Species == "L_goo" ~ "L. goodei",
      Species == "L_gul" ~ "L. gulosus",
      #Species == "L_mac" ~ "L. macrochirus",
      Species == "L_mar" ~ "L. marginatus",
      #Species == "L_mic" ~ "L. microlophus",
      Species == "L_pun" ~ "L. punctatus",
      Species == "L_pla" ~ "L. platyrhincus",
      #Species == "M_sal" ~ "M. salmoides",
      #Species == "N_gyr" ~ "N. gyrinus"
      Species == "P_lat" ~ "P. latipinna"
      #Species == "T_mar" ~ "P. mariae"
    )) %>% 
  filter(!is.na(`Percent Change`)) %>% 
  arrange(Species) %>% 
  mutate(across(where(is.numeric), round, digits = 2)) %>% 
  select(Invasion_Status, Habitat, Species, `Size Class`, Wet, Dry, `Wet < Dry`, 
         Direction, `Percent Change`)

```

### Plot Pre- vs Post-Invasion 
#### Trophic Niche Ellipses

Reformat data for plotting
```{r}
#reformat data to be able to make boxplots or violoin plots
#also isolating species size classes from habitat-season levels that are present both pre- and post-invasion
pre.post.plot.species <- pre.post.direct.spp.pairwise %>% 
  mutate(Species_Abr = case_when(
    Species == "A. natalis" ~ "A_nat",
    Species == "M. urophthalmus" ~ "C_uro",
    Species == "E. evergladei" ~ "E_eve",
    Species == "E. gloriosus" ~ "E_glo",
    Species == "F. chrysotus" ~ "F_chr",
    Species == "G. holbrooki" ~ "G_hol",
    Species == "H. formosa" ~ "H_for",
    Species == "J. floridae" ~ "J_flo",
    Species == "L. goodei" ~ "L_goo",
    Species == "L. gulosus" ~ "L_gul",
    Species == "L. macrochirus" ~ "L_mac",
    Species =="L. marginatus" ~ "L_mar",
    Species == "L. microlophus" ~ "L_mic",
    Species == "L. punctatus" ~ "L_pun",
    Species == "L. platyrhincus" ~ "L_pla",
    Species == "M. salmoides" ~ "M_sal",
    Species == "P. latipinna" ~ "P_lat",
    Species == "P. mariae" ~"T_mar")) %>% 
  unite("Habitat_Season", c(Habitat, Season), sep = "_") %>% 
  unite("Spp_Class", c(Species_Abr, `Size Class`), sep = "") %>% 
  unite("Plot_Levels", c(Habitat_Season, Spp_Class), sep = ".")

pre.post.plot.data <- pre.post.SEA.B %>% as.data.frame() %>% 
  pivot_longer(everything(), names_to = c("Invasion Status", "Species"), 
               names_sep = "[//.]", values_to = "SEA_B") %>% 
  separate(`Invasion Status`, into = c("Habitat", "Season", "Invasion Status"), "_") %>% 
  unite("Habitat_Season", c(Habitat, Season), sep = "_") %>% 
  unite(Habitat_Season_Spp, c(Habitat_Season, Species), sep = ".") %>% 
  filter(Habitat_Season_Spp %in% pre.post.plot.species$Plot_Levels) %>% 
  separate(Habitat_Season_Spp, into = c("Habitat_Season", "Species"), sep = "[//.]") %>% 
  separate(Habitat_Season, into = c("Habitat", "Season"), sep = "_")

```

Box plots
```{r}
#plot these data
windowsFonts(Times = windowsFont("Times New Roman"))

(pre.post.seab<-ggplot(pre.post.plot.data, aes(x = Species, y = SEA_B, fill = `Invasion Status`))+
    geom_boxplot(outlier.size = 0,outlier.alpha = 0, lwd = 0.1, alpha = 0.5)+
    facet_grid(Habitat~Season, scales = "free_x")+
    scale_color_viridis_d(aesthetics = "fill", option = "D", end = 0.75)+
    scale_y_continuous(limits = c(0, 2.5), expand = c(0.01, 0))+
    theme_bw(base_size = 12)+
    xlab(NULL)+
    ylab(expression("Stomach Content Niche Area - SEA"["b"]))+
    theme(text = element_text(family = "Times", size = 12),
          axis.text.x = element_text(angle = 45, vjust = 1.1, hjust = 1, size = 4),
          #panel.border = element_blank(), 
          #panel.grid.major = element_blank(),
          #panel.grid.minor = element_blank(), 
          axis.line = element_line(colour = "black"),
          axis.ticks.x = element_line(size = 0.05),
          axis.title = element_text(size = 12), axis.text.x.bottom = element_text(size = 7),
          axis.text.y = element_text(size = 7), axis.ticks.y = element_line(size = 0.2),
          legend.title = element_blank(), legend.text = element_text(size = 8),
          legend.key.size = unit(0.75, "line"))
  
)

ggsave(filename = "Figures/Stomach Contents/Trophic Niche/Pre-vs-Post-Invasion/pre_post_SEAb.tiff", 
       plot = pre.post.seab, 
       dpi = 300, width = 200, height = 100, units = "mm")
```

#### Frequency Histogram of Effect Sizes
##### Invasion Effect Sizes
Reformat data for plotting
```{r}
pre.post.stat.diff.guild <- pre.post.direct.spp.pairwise %>% 
  #filter(`Pre < Post` >= 0.95 | `Pre < Post` <= 0.05) %>% 
  mutate(Guild = case_when(
    Species %in% c("P. latipinna", "P. mariae") ~ "Detritivore",
    Species %in% c("E. evergladei", "E. gloriosus", "F. chrysotus", "L. goodei", "L. macrochirus",
                   "L. marginatus", "L. microlophus") ~ "Invertivore",
    Species == "L. gulosus" ~ "Mesopredator",
    Species %in% c("M. salmoides", "L. platyrhincus") ~ "Top Predator",
    Species %in% c("A. natalis", "G. holbrooki", "H. formosa", "J. floridae", "L. punctatus", 
                   "M. urophthalmus") ~ "Omnivore"
  ),
  `Statistically Different` = case_when(
    `Pre < Post` >= 0.95 | `Pre < Post` <= 0.05 ~ "Yes",
    T ~ "No"
  ))

```

Generate Plot
```{r}
windowsFonts(Times = windowsFont("Times New Roman"))

(pre.post.stat.diff.freq.hist <- ggplot(data = pre.post.stat.diff.guild, 
                                        aes(x = `Percent Change`, fill = Guild, color = `Statistically Different`))+
    geom_histogram(bins = 20)+
    facet_grid(Habitat ~ Season, scales = "free")+
    scale_fill_viridis_d(option = "C")+
    scale_color_viridis_d(option = "B", direction = -1)+
    scale_y_continuous(expand = c(0,0))+
    #scale_x_continuous()
    ylab("Number of Species Size Classes")+
    xlab("Trophic Dispersion - Percent Change in Trophic Niche Area")+
    theme_bw(base_size = 12)+
    theme(text = element_text(family = "Times", size = 12),
          #axis.text.x = element_text(angle = 45, vjust = 1.1, hjust = 1, size = 4),
          #panel.border = element_blank(), 
          #panel.grid.major = element_blank(),
          #panel.grid.minor = element_blank(), 
          axis.line = element_line(colour = "black"),
          axis.ticks.x = element_line(size = 0.05),
          axis.title = element_text(size = 12), axis.text.x.bottom = element_text(size = 7),
          axis.text.y = element_text(size = 7), axis.ticks.y = element_line(size = 0.2),
          #legend.title = element_blank(), 
          legend.text = element_text(size = 8)#,
          #legend.key.size = unit(0.75, "line")
          )

)

ggsave(filename = "Figures/Stomach Contents/Trophic Niche/Pre-vs-Post-Invasion/pre_post_SEAb_effect_size_freq_hist.tiff", 
       plot = pre.post.stat.diff.freq.hist, 
       dpi = 300, width = 200, height = 100, units = "mm")
```

##### Pre/Post Habitat Shift Effect Sizes
```{r}
pre.post.habitat.shifts <- bind_rows(pre.marsh.pond.wet.direct.spp.pairwise,
                                     pre.marsh.pond.Dry.direct.spp.pairwise,
                                     post.marsh.pond.wet.direct.spp.pairwise,
                                     post.marsh.pond.dry.direct.spp.pairwise) %>% 
  mutate(Guild = case_when(
    Species %in% c("P. latipinna", "P. mariae", "O. aureus") ~ "Detritivore",
    Species %in% c("E. evergladei", "E. gloriosus", "F. chrysotus", "L. goodei", "L. macrochirus",
                   "L. marginatus", "L. microlophus", "E. sucetta", "F. confluentus") ~ "Invertivore",
    Species == "L. gulosus" ~ "Mesopredator",
    Species %in% c("M. salmoides", "L. platyrhincus") ~ "Top Predator",
    Species %in% c("A. natalis", "G. holbrooki", "H. formosa", "J. floridae", "L. punctatus", 
                   "M. urophthalmus", "N. gyrinus", "H. letourneuxi", "H. littorale") ~ "Omnivore"
  )) %>% 
  mutate(Invasion_Status = case_when(
    Invasion_Status == "Pre" ~ "Pre-Invasion",
    Invasion_Status == "Post" ~ "Post-Invasion"
  )) %>% 
  rename(`Invasion Status` = Invasion_Status) %>% 
  filter(`Marsh < Pond` >= 0.95 | `Marsh < Pond` <= 0.05)

windowsFonts(Times = windowsFont("Times New Roman"))

(pre.post.habitat.freq.hist <- ggplot(data = pre.post.habitat.shifts, aes(x = `Percent Change`, fill = Guild))+
    geom_histogram(bins = 20)+
    facet_grid(`Invasion Status` ~ Season, scales = "free")+
    scale_fill_viridis_d(option = "C")+
    scale_y_continuous(expand = c(0,0))+
    #scale_x_continuous()
    ylab("Frequency")+
    theme_bw(base_size = 12)+
    theme(text = element_text(family = "Times", size = 12),
          #axis.text.x = element_text(angle = 45, vjust = 1.1, hjust = 1, size = 4),
          #panel.border = element_blank(), 
          #panel.grid.major = element_blank(),
          #panel.grid.minor = element_blank(), 
          axis.line = element_line(colour = "black"),
          axis.ticks.x = element_line(size = 0.05),
          axis.title = element_text(size = 12), axis.text.x.bottom = element_text(size = 7),
          axis.text.y = element_text(size = 7), axis.ticks.y = element_line(size = 0.2),
          legend.title = element_blank(), legend.text = element_text(size = 8)#,
          #legend.key.size = unit(0.75, "line")
    )
  
)

ggsave(filename = "Figures/Stomach Contents/Trophic Niche/Pre-vs-Post-Invasion/pre_post_SEAb_habitat_effect_size_freq_hist.tiff", 
       plot = pre.post.habitat.freq.hist, 
       dpi = 300, width = 200, height = 100, units = "mm")
```

##### Pre/Post Season Shift Effect Sizes
```{r}
pre.post.season.shifts <- bind_rows(pre.marsh.wet.dry.direct.spp.pairwise,
                                     pre.pond.wet.dry.direct.spp.pairwise,
                                     post.marsh.wet.dry.direct.spp.pairwise,
                                     post.pond.wet.dry.direct.spp.pairwise) %>% 
  mutate(Guild = case_when(
    Species %in% c("P. latipinna", "P. mariae", "O. aureus") ~ "Detritivore",
    Species %in% c("E. evergladei", "E. gloriosus", "F. chrysotus", "L. goodei", "L. macrochirus",
                   "L. marginatus", "L. microlophus", "E. sucetta", "F. confluentus") ~ "Invertivore",
    Species == "L. gulosus" ~ "Mesopredator",
    Species %in% c("M. salmoides", "L. platyrhincus", "B. belizanus") ~ "Top Predator",
    Species %in% c("A. natalis", "G. holbrooki", "H. formosa", "J. floridae", "L. punctatus", 
                   "M. urophthalmus", "N. gyrinus", "H. letourneuxi", "H. littorale", 
                   "C. batrachus", "C. variegatus") ~ "Omnivore"
  )) %>% 
  mutate(Invasion_Status = case_when(
    Invasion_Status == "Pre" ~ "Pre-Invasion",
    Invasion_Status == "Post" ~ "Post-Invasion"
  )) %>% 
  rename(`Invasion Status` = Invasion_Status) %>% 
  filter(`Wet < Dry` >= 0.95 | `Wet < Dry` <= 0.05)

windowsFonts(Times = windowsFont("Times New Roman"))

(pre.post.season.freq.hist <- ggplot(data = pre.post.season.shifts, aes(x = `Percent Change`, fill = Guild))+
    geom_histogram(bins = 20)+
    facet_grid(`Invasion Status` ~ Habitat, scales = "free")+
    scale_fill_viridis_d(option = "C")+
    scale_y_continuous(expand = c(0,0))+
    #scale_x_continuous()
    ylab("Frequency")+
    theme_bw(base_size = 12)+
    theme(text = element_text(family = "Times", size = 12),
          #axis.text.x = element_text(angle = 45, vjust = 1.1, hjust = 1, size = 4),
          #panel.border = element_blank(), 
          #panel.grid.major = element_blank(),
          #panel.grid.minor = element_blank(), 
          axis.line = element_line(colour = "black"),
          axis.ticks.x = element_line(size = 0.05),
          axis.title = element_text(size = 12), axis.text.x.bottom = element_text(size = 7),
          axis.text.y = element_text(size = 7), axis.ticks.y = element_line(size = 0.2),
          legend.title = element_blank(), legend.text = element_text(size = 8)#,
          #legend.key.size = unit(0.75, "line")
    )
  
)

ggsave(filename = "Figures/Stomach Contents/Trophic Niche/Pre-vs-Post-Invasion/pre_post_SEAb_season_effect_size_freq_hist.tiff", 
       plot = pre.post.season.freq.hist, 
       dpi = 300, width = 200, height = 100, units = "mm")
```

### Summary Metrics for Shifts in Trophic Niche Area
```{r}
#mean and sd of different shifts
#pre-invasion habitat
pre.habitat.shifts <- pre.post.habitat.shifts %>% 
  filter(`Invasion Status` == "Pre-Invasion")

mean(pre.habitat.shifts$`Percent Change`)
sd(pre.habitat.shifts$`Percent Change`)

#post-invasion habitat
post.habitat.shifts <- pre.post.habitat.shifts %>% 
  filter(`Invasion Status` == "Post-Invasion")

mean(post.habitat.shifts$`Percent Change`)
sd(post.habitat.shifts$`Percent Change`)

#pre-invasion frequency
nrow(pre.habitat.shifts)/nrow(
  bind_rows(pre.marsh.pond.wet.direct.spp.pairwise,
            pre.marsh.pond.Dry.direct.spp.pairwise)
)

#post-invasion frequency
nrow(post.habitat.shifts)/nrow(
  bind_rows(
            post.marsh.pond.wet.direct.spp.pairwise,
            post.marsh.pond.dry.direct.spp.pairwise)
)


#pre-invasion season
pre.season.shifts <- pre.post.season.shifts %>% 
  filter(`Invasion Status` == "Pre-Invasion")

mean(pre.season.shifts$`Percent Change`)
sd(pre.season.shifts$`Percent Change`)

#post-invasion season
post.season.shifts <- pre.post.season.shifts %>% 
  filter(`Invasion Status` == "Post-Invasion")

mean(post.season.shifts$`Percent Change`)
sd(post.season.shifts$`Percent Change`)

#pre-invasion frequency
nrow(pre.season.shifts)/nrow(
  bind_rows(pre.marsh.wet.dry.direct.spp.pairwise,
            pre.pond.wet.dry.direct.spp.pairwise)
)

#post-invasion frequency
nrow(post.season.shifts)/nrow(
  bind_rows(post.marsh.wet.dry.direct.spp.pairwise,
            post.pond.wet.dry.direct.spp.pairwise)
)

#overall spatiotemporal mean percent change
spatiotemporal.changes <- bind_rows(
  pre.post.season.shifts,
  pre.post.habitat.shifts
)

#average magnitude
mean(spatiotemporal.changes$`Percent Change`)
sd(spatiotemporal.changes$`Percent Change`)

#frequency
nrow(spatiotemporal.changes)/nrow(
  bind_rows(
    pre.marsh.wet.dry.direct.spp.pairwise,
    pre.pond.wet.dry.direct.spp.pairwise,
    post.marsh.wet.dry.direct.spp.pairwise,
    post.pond.wet.dry.direct.spp.pairwise,
    pre.marsh.pond.wet.direct.spp.pairwise,
    pre.marsh.pond.Dry.direct.spp.pairwise,
    post.marsh.pond.wet.direct.spp.pairwise,
    post.marsh.pond.dry.direct.spp.pairwise
  )
)

#post-invasion spatiotemporal
#magnitude
post.spatiotemporal.changes <- spatiotemporal.changes %>% 
  filter(`Invasion Status` == "Post-Invasion")

mean(post.spatiotemporal.changes$`Percent Change`)
sd(post.spatiotemporal.changes$`Percent Change`)

#frequency
nrow(post.spatiotemporal.changes)/
  nrow(
    bind_rows(
      post.marsh.wet.dry.direct.spp.pairwise,
      post.pond.wet.dry.direct.spp.pairwise,
      post.marsh.pond.wet.direct.spp.pairwise,
      post.marsh.pond.dry.direct.spp.pairwise
    ) 
  )

#pre-invasion spatiotemporal
pre.spatiotemporal.changes <- spatiotemporal.changes %>% 
  filter(`Invasion Status` == "Pre-Invasion")

mean(pre.spatiotemporal.changes$`Percent Change`)
sd(pre.spatiotemporal.changes$`Percent Change`)

#frequency
nrow(pre.spatiotemporal.changes)/
  nrow(
    bind_rows(
      pre.marsh.wet.dry.direct.spp.pairwise,
      pre.pond.wet.dry.direct.spp.pairwise,
      pre.marsh.pond.wet.direct.spp.pairwise,
      pre.marsh.pond.Dry.direct.spp.pairwise
    ) 
  )
```